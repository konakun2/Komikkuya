<!-- Cinematic Notification Popup -->
<div id="notificationPopup"
    class="fixed inset-0 bg-black/90 backdrop-blur-2xl z-[100] flex items-center justify-center hidden opacity-0 transition-opacity duration-500">
    <div
        class="relative bg-[#1a1625]/80 border border-white/10 p-10 max-w-lg mx-4 shadow-[0_0_50px_rgba(147,51,234,0.1)] overflow-hidden animate-in fade-in zoom-in-95 duration-500">

        <!-- Ambient Background Glow -->
        <div class="absolute -top-24 -right-24 w-48 h-48 bg-purple-600/20 blur-[80px] rounded-full"></div>
        <div class="absolute -bottom-24 -left-24 w-48 h-48 bg-pink-600/10 blur-[80px] rounded-full"></div>

        <div class="relative z-10">
            <div class="flex justify-between items-start mb-8">
                <div>
                    <h2 class="text-xs font-black text-purple-500 uppercase tracking-[0.4em] mb-2 italic">Notifications
                    </h2>
                    <h1
                        class="text-4xl md:text-5xl font-black text-white uppercase italic tracking-tighter leading-none">
                        Stay<br><span class="stroke-text">Updated</span>
                    </h1>
                </div>
                <button onclick="closeNotificationPopup()"
                    class="group p-2 -mr-2 text-white/20 hover:text-white transition-all duration-300">
                    <svg class="w-8 h-8 transform group-hover:rotate-90 transition-transform duration-500" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <p
                class="text-white/40 text-[13px] font-bold uppercase tracking-widest leading-loose mb-10 text-justify italic">
                Dapetin update instan tiap ada rilisan baru. Gabung komunitas premium WhatsApp kita biar gak ketinggalan
                satu chapter-pun.
            </p>

            <div class="grid grid-cols-1 gap-4">
                <a href="https://whatsapp.com/channel/0029Vb7586h2UPBFAPxb5S1P"
                    class="group relative flex items-center justify-center gap-4 px-8 py-5 bg-gradient-to-r from-purple-600 to-pink-600 text-white text-xs font-black uppercase tracking-[0.3em] italic overflow-hidden transition-all duration-500 hover:scale-[1.02] active:scale-95 shadow-xl shadow-purple-900/40">
                    <div
                        class="absolute inset-0 bg-white/20 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000 skew-x-12">
                    </div>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-whatsapp" viewBox="0 0 16 16">
                        <path
                            d="M13.601 2.326A7.85 7.85 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.9 7.9 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.9 7.9 0 0 0 13.6 2.326zM7.994 14.521a6.6 6.6 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.56 6.56 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592m3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.73.73 0 0 0-.529.247c-.182.198-.691.677-.691 1.654s.71 1.916.81 2.049c.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232" />
                    </svg>
                    <span>Follow Channel</span>
                </a>

                <button onclick="closeNotificationPopup()"
                    class="px-8 py-5 border border-white/5 text-white/20 text-xs font-black uppercase tracking-[0.3em] italic hover:bg-white/5 hover:text-white transition-all duration-500">
                    Maybe Later
                </button>
            </div>
        </div>
    </div>
</div>


<div class="relative overflow-hidden bg-primary-950">
    <!-- Background Ambient Glows -->
    <div
        class="absolute top-0 right-0 -translate-y-1/2 translate-x-1/2 w-[800px] h-[800px] bg-purple-600/10 blur-[120px] rounded-full pointer-events-none animate-drift">
    </div>
    <div
        class="absolute bottom-1/4 left-0 -translate-x-1/2 w-[600px] h-[600px] bg-purple-900/10 blur-[100px] rounded-full pointer-events-none animate-swell">
    </div>

    <style>
        @keyframes drift {

            0%,
            100% {
                transform: translate(50%, -50%) scale(1);
            }

            50% {
                transform: translate(45%, -45%) scale(1.1);
            }
        }

        @keyframes swell {

            0%,
            100% {
                transform: translate(-50%, 0) scale(1);
                opacity: 0.4;
            }

            50% {
                transform: translate(-45%, 5%) scale(1.15);
                opacity: 0.6;
            }
        }

        .animate-drift {
            animation: drift 20s ease-in-out infinite;
        }

        .animate-swell {
            animation: swell 25s ease-in-out infinite;
        }

        .stroke-text {
            -webkit-text-stroke: 1px rgba(255, 255, 255, 0.1);
            color: transparent;
        }
    </style>

    <div class="space-y-12 relative z-10">

        <!-- Cinematic Hero Section (Netflix/Crunchyroll Style) -->
        <section class="relative w-full h-[65vh] min-h-[500px] max-h-[850px] -mt-12 mb-16 overflow-hidden group">
            <div id="heroCarousel" class="relative h-full w-full">
                <% recommendations.slice(0, 5).forEach((manga, index)=> { %>
                    <div class="hero-slide absolute inset-0 transition-all duration-[1500ms] cubic-bezier(0.4, 0, 0.2, 1) <%= index === 0 ? 'opacity-100 z-10' : 'opacity-0 z-0' %>"
                        data-index="<%= index %>">

                        <!-- Full-Bleed Background Image with Ken Burns Zoom Effect -->
                        <div class="absolute inset-0 z-0 overflow-hidden">
                            <img src="<%= wsrvUrl(manga.imageUrl) %>" alt="<%= manga.title %>"
                                class="hero-img w-full h-full object-cover object-[center_20%] transition-transform duration-[12000ms] ease-out <%= index === 0 ? 'scale-110' : 'scale-100' %>"
                                style="filter: brightness(0.55) contrast(1.2) saturate(1.15);">
                        </div>

                        <!-- Cinematic Gradients -->
                        <div
                            class="absolute inset-0 bg-gradient-to-r from-primary-900 via-primary-900/40 to-transparent z-10 hidden md:block">
                        </div>
                        <div
                            class="absolute inset-0 bg-gradient-to-t from-primary-900 via-transparent to-transparent z-10 top-1/2">
                        </div>
                        <div
                            class="absolute inset-0 bg-gradient-to-b from-primary-900/60 via-transparent to-transparent z-10 h-40">
                        </div>
                        <div
                            class="absolute bottom-0 left-0 right-0 h-48 bg-gradient-to-t from-primary-900 to-transparent z-15">
                        </div>

                        <!-- Immersive Content Area -->
                        <div class="absolute inset-0 z-20 container mx-auto px-6 md:px-12 flex flex-col justify-center">
                            <div
                                class="max-w-4xl hero-content-box transition-all duration-1000 transform <%= index === 0 ? 'translate-y-0 opacity-100' : 'translate-y-16 opacity-0' %>">

                                <!-- Sub-header Metadata -->
                                <div class="flex items-center gap-4 mb-6">
                                    <div class="flex items-center gap-2">
                                        <span class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span>
                                        <span
                                            class="text-white text-xs font-black tracking-[0.3em] uppercase drop-shadow-md">REKOMENDASI
                                            ADMIN</span>
                                    </div>
                                    <div class="h-4 w-[1px] bg-white/20"></div>
                                    <span class="text-purple-400 font-bold text-sm tracking-widest uppercase">
                                        <%= manga.genre %>
                                    </span>
                                </div>

                                <!-- Mega-Title Typography (Enforced 2-line clamp to prevent clashing) -->
                                <h1
                                    class="text-4xl sm:text-6xl md:text-7xl lg:text-[90px] font-black text-white mb-4 md:mb-6 uppercase tracking-[-0.05em] leading-[0.85] italic drop-shadow-[0_15px_15px_rgba(0,0,0,0.6)] line-clamp-2">
                                    <%= manga.title %>
                                </h1>

                                <!-- Social Proof & Info -->
                                <div class="flex items-center gap-8 mb-12 text-white/80 font-bold tracking-tight">
                                    <div class="flex items-center gap-2 text-yellow-400">
                                        <svg class="w-5 h-5 fill-current" viewBox="0 0 20 20">
                                            <path
                                                d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118l-2.8-2.034c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                        </svg>
                                        <span class="text-xl italic">9.8</span>
                                    </div>
                                    <div class="h-5 w-[2px] bg-white/10"></div>
                                    <span class="text-white text-lg">
                                        <%= manga.latestChapter.title %>
                                    </span>
                                    <div class="h-5 w-[2px] bg-white/10"></div>
                                    <span
                                        class="px-3 py-1 bg-white/10 rounded-sm text-[10px] uppercase font-black tracking-widest border border-white/20">
                                        <%= manga.genre %>
                                    </span>
                                </div>

                                <!-- Action Buttons -->
                                <div class="flex items-center gap-3 md:gap-5">
                                    <a href="/manga/<%= manga.url.split('/manga/')[1].replace('/', '') %>"
                                        class="group/btn relative flex items-center gap-2 md:gap-4 px-6 py-3 md:px-12 md:py-5 bg-white text-black font-black rounded-sm shadow-[0_20px_40px_rgba(255,255,255,0.1)] transition-all duration-400 hover:bg-purple-600 hover:text-white transform hover:-translate-y-2 active:scale-95">
                                        <svg class="w-6 h-6 md:w-8 md:h-8 fill-current" viewBox="0 0 24 24">
                                            <path d="M8 5v14l11-7z" />
                                        </svg>
                                        <span class="text-sm md:text-lg tracking-tight">MULAI BACA</span>
                                    </a>
                                    <div class="relative group/info-container">
                                        <button
                                            class="group/info relative p-3 md:p-5 bg-white/5 backdrop-blur-xl border border-white/10 text-white rounded-sm hover:bg-white/10 transition-all duration-400 hover:scale-105 active:scale-95 peer">
                                            <svg class="w-6 h-6 md:w-8 md:h-8" fill="none" stroke="currentColor"
                                                viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                        </button>

                                        <!-- Premium Synopsis Tooltip (Responsive Fix) -->
                                        <div
                                            class="absolute bottom-full left-0 mb-6 w-[calc(100vw-80px)] sm:w-80 md:w-96 p-5 md:p-6 bg-black/80 backdrop-blur-2xl border border-white/10 rounded-sm opacity-0 translate-y-4 pointer-events-none group-hover/info-container:opacity-100 group-hover/info-container:translate-y-0 peer-focus:opacity-100 peer-focus:translate-y-0 transition-all duration-500 z-50 shadow-[0_30px_60px_rgba(0,0,0,0.8)]">
                                            <div
                                                class="flex items-center gap-2 mb-3 text-purple-400 text-[10px] font-black uppercase tracking-[0.2em]">
                                                <span class="w-8 h-[1px] bg-purple-500"></span>
                                                Synopsis
                                            </div>
                                            <p
                                                class="text-white/80 text-xs md:text-sm font-medium leading-relaxed italic break-words">
                                                <%= manga.tentang || 'Kisah epik yang menanti untuk dijelajahi...' %>
                                            </p>
                                            <!-- Decorative Corner -->
                                            <div
                                                class="absolute -bottom-2 left-6 w-4 h-4 bg-black/80 rotate-45 border-r border-b border-white/10">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <% }); %>

                        <!-- Dynamic Interactive Controls -->
                        <div
                            class="absolute right-4 md:right-8 top-0 bottom-0 z-30 flex flex-col items-center justify-center gap-4 md:gap-8">
                            <% recommendations.slice(0, 5).forEach((_, index)=> { %>
                                <button class="carousel-dot group/dot flex flex-col items-center"
                                    data-index="<%= index %>">
                                    <div
                                        class="relative w-1 h-10 md:w-1.5 md:h-16 bg-white/5 rounded-full overflow-hidden transition-all duration-700 group-hover/dot:bg-white/20 <%= index === 0 ? 'h-16 md:h-24 bg-white/20' : '' %>">
                                        <div
                                            class="progress-fill absolute bottom-0 left-0 right-0 h-0 bg-gradient-to-t from-purple-500 via-pink-500 to-purple-400 transition-all duration-100 ease-linear">
                                        </div>
                                    </div>
                                    <span
                                        class="absolute right-full mr-6 text-[10px] md:text-xs font-black tracking-widest text-white/50 opacity-0 transform translate-x-4 group-hover/dot:opacity-100 group-hover/dot:translate-x-0 transition-all uppercase whitespace-nowrap hidden sm:block">
                                        Vol. 0<%= index + 1 %>
                                    </span>
                                </button>
                                <% }); %>
                        </div>

                        <!-- Sleek Arrow Navigation (Repositioned to avoid button clash) -->
                        <div class="absolute bottom-6 left-6 z-30 flex items-center gap-4">
                            <button id="heroPrev"
                                class="p-3 md:p-4 border border-white/10 bg-black/60 text-white hover:bg-white hover:text-black transition-all duration-400 rounded-sm backdrop-blur-md group/arrow">
                                <svg class="w-5 h-5 md:w-6 md:h-6 transform group-hover/arrow:-translate-x-1 transition-transform"
                                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 19l-7-7 7-7" />
                                </svg>
                            </button>
                            <button id="heroNext"
                                class="p-3 md:p-4 border border-white/10 bg-black/60 text-white hover:bg-white hover:text-black transition-all duration-400 rounded-sm backdrop-blur-md group/arrow">
                                <svg class="w-5 h-5 md:w-6 md:h-6 transform group-hover/arrow:translate-x-1 transition-transform"
                                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 5l7 7-7 7" />
                                </svg>
                            </button>
                        </div>
            </div>
        </section>

        <!-- Content Container -->
        <div class="max-w-[1800px] mx-auto px-6 md:px-12 pb-32">
            <div class="space-y-12">
                <!-- Alert Banners -->
                <div class="space-y-4">
                    <!-- Server Info Alert -->
                    <div id="serverAlert"
                        class="relative group bg-[#1a1625]/60 backdrop-blur-md border-l-4 border-l-purple-600 border border-white/5 p-5 flex items-center justify-between overflow-hidden transition-all duration-500 hover:bg-[#1a1625]/80">

                        <!-- Subtle Glow -->
                        <div
                            class="absolute -right-20 -top-20 w-40 h-40 bg-purple-600/10 blur-[60px] rounded-full group-hover:bg-purple-600/20 transition-all duration-700">
                        </div>

                        <div class="flex items-center gap-5 relative z-10">
                            <div
                                class="flex-shrink-0 w-12 h-12 flex items-center justify-center bg-purple-600/10 border border-purple-500/20 rounded-sm">
                                <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <div>
                                <div class="flex items-center gap-2 mb-1">
                                    <span
                                        class="text-[10px] font-black text-purple-500 uppercase tracking-[0.3em] italic">Pro
                                        Tip</span>
                                    <h4 class="text-xs font-black text-white uppercase tracking-wider italic">Universal
                                        Search Enabled</h4>
                                </div>
                                <p
                                    class="text-white/40 text-[11px] font-bold uppercase tracking-widest leading-relaxed italic">
                                    Gunakan fitur <span class="text-white">Search</span> untuk akses manga dari semua
                                    server sekaligus!
                                </p>
                                <div class="flex items-center gap-3 mt-3">
                                    <span
                                        class="flex items-center gap-1.5 px-2 py-0.5 bg-white/5 border border-white/5 text-[9px] font-black text-white/50 uppercase italic group-hover:border-purple-500/30 transition-colors">
                                        <span class="w-1.5 h-1.5 rounded-full bg-purple-500"></span> ID
                                    </span>
                                    <span
                                        class="flex items-center gap-1.5 px-2 py-0.5 bg-white/5 border border-white/5 text-[9px] font-black text-white/50 uppercase italic group-hover:border-blue-500/30 transition-colors">
                                        <span class="w-1.5 h-1.5 rounded-full bg-blue-500"></span> ASIA
                                    </span>
                                    <span
                                        class="flex items-center gap-1.5 px-2 py-0.5 bg-white/5 border border-white/5 text-[9px] font-black text-white/50 uppercase italic group-hover:border-green-500/30 transition-colors">
                                        <span class="w-1.5 h-1.5 rounded-full bg-green-500"></span> EN
                                    </span>
                                </div>
                            </div>
                        </div>
                        <button onclick="document.getElementById('serverAlert').remove()"
                            class="flex-shrink-0 ml-4 p-2 text-white/10 hover:text-white transition-all duration-300 transform hover:rotate-90">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>

                    <!-- Project Promotion Banner -->
                    <div id="promoBanner"
                        class="relative group bg-gradient-to-r from-[#1a1625]/80 to-primary-950/80 backdrop-blur-xl border border-white/5 p-6 overflow-hidden">

                        <!-- Animated Border Bottom -->
                        <div
                            class="absolute bottom-0 left-0 h-[2px] w-full bg-gradient-to-r from-transparent via-purple-600 to-transparent transform scale-x-0 group-hover:scale-x-100 transition-transform duration-1000">
                        </div>

                        <div
                            class="flex flex-col md:flex-row md:items-center justify-between gap-6 relative z-10 pr-10">
                            <div class="flex items-start gap-4">
                                <div
                                    class="flex-shrink-0 w-10 h-10 flex items-center justify-center bg-blue-600/10 border border-blue-500/20 rounded-sm">
                                    <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                                    </svg>
                                </div>
                                <div>
                                    <h5
                                        class="text-[10px] font-black text-blue-500 uppercase tracking-[0.4em] mb-1 italic">
                                        Network Projects</h5>
                                    <h4 class="text-sm font-black text-white uppercase tracking-tighter italic">Explore
                                        More Experiences</h4>
                                </div>
                            </div>

                            <div class="flex flex-wrap gap-3">
                                <a href="https://donghua.komikkuya.my.id/" target="_blank" rel="noopener"
                                    class="group/btn flex items-center gap-3 px-5 py-2.5 bg-white/[0.03] border border-white/5 hover:border-red-500/40 transition-all duration-500">
                                    <svg class="w-4 h-4 text-red-500 transition-transform group-hover/btn:scale-125 duration-300"
                                        fill="currentColor" viewBox="0 0 24 24">
                                        <path
                                            d="M18 3v2h-2V3H8v2H6V3H4v18h2v-2h2v2h8v-2h2v2h2V3h-2zM8 17H6v-2h2v2zm0-4H6v-2h2v2zm0-4H6V7h2v2zm10 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2z" />
                                    </svg>
                                    <span
                                        class="text-[10px] font-black text-white/60 group-hover/btn:text-white uppercase tracking-widest italic transition-colors">Donghua</span>
                                </a>
                                <a href="https://steam.kotaklegend.my.id/" target="_blank" rel="noopener"
                                    class="group/btn flex items-center gap-3 px-5 py-2.5 bg-white/[0.03] border border-white/5 hover:border-blue-500/40 transition-all duration-500">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        class="w-4 h-4 text-blue-500 transition-transform group-hover/btn:scale-125 duration-300"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M.329 10.333A8.01 8.01 0 0 0 7.99 16C12.414 16 16 12.418 16 8s-3.586-8-8.009-8A8.006 8.006 0 0 0 0 7.468l.003.006 4.304 1.769A2.2 2.2 0 0 1 5.62 8.88l1.96-2.844-.001-.04a3.046 3.046 0 0 1 3.042-3.043 3.046 3.046 0 0 1 3.042 3.043 3.047 3.047 0 0 1-3.111 3.044l-2.804 2a2.223 2.223 0 0 1-3.075 2.11 2.22 2.22 0 0 1-1.312-1.568L.33 10.333Z" />
                                        <path
                                            d="M4.868 12.683a1.715 1.715 0 0 0 1.318-3.165 1.7 1.7 0 0 0-1.263-.02l1.023.424a1.261 1.261 0 1 1-.97 2.33l-.99-.41a1.7 1.7 0 0 0 .882.84Zm3.726-6.687a2.03 2.03 0 0 0 2.027 2.029 2.03 2.03 0 0 0 2.027-2.029 2.03 2.03 0 0 0-2.027-2.027 2.03 2.03 0 0 0-2.027 2.027m2.03-1.527a1.524 1.524 0 1 1-.002 3.048 1.524 1.524 0 0 1 .002-3.048" />
                                    </svg>
                                    <span
                                        class="text-[10px] font-black text-white/60 group-hover/btn:text-white uppercase tracking-widest italic transition-colors">Steam
                                        Inject</span>
                                </a>
                            </div>

                            <button onclick="document.getElementById('promoBanner').remove()"
                                class="absolute top-4 right-4 text-white/10 hover:text-white transition-all duration-300 p-1">
                                <svg class="w-5 h-5 rotate-45" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v16m8-8H4" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Main Content with Sidebar -->
                <!-- Main Content with Cinematic Sidebar -->
                <div class="flex flex-col lg:flex-row gap-12 mt-8">
                    <!-- Main Content (Streaming Style Grids) -->
                    <div class="flex-1 space-y-16">

                        <!-- Hot Section (Trending Row) -->
                        <section class="relative group/section">
                            <div class="flex items-end justify-between mb-8 border-l-4 border-purple-600 pl-6">
                                <div>
                                    <h2 class="text-4xl font-black text-white uppercase tracking-tighter italic">
                                        Trending Now
                                    </h2>
                                    <p class="text-gray-500 mt-1 font-bold text-sm tracking-widest uppercase">Paling
                                        banyak
                                        dibaca
                                        minggu ini</p>
                                </div>
                                <a href="/popular"
                                    class="group flex items-center gap-2 text-xs font-black text-white/50 hover:text-white transition-all uppercase tracking-widest">
                                    See All
                                    <svg class="w-4 h-4 transform group-hover:translate-x-1 transition-transform"
                                        fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 5l7 7-7 7" />
                                    </svg>
                                </a>
                            </div>

                            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-5 gap-x-5 gap-y-10">
                                <% hotManga.slice(0, 10).forEach(manga=> { %>
                                    <div class="group/card relative">
                                        <a href="/manga/<%= manga.url.split('/manga/')[1]?.replace('/', '') || '' %>"
                                            class="block">
                                            <div
                                                class="relative aspect-[2/3] overflow-hidden rounded-sm bg-primary-800 shadow-2xl">
                                                <img src="<%= wsrvUrl(manga.imageUrl) %>" alt="<%= manga.title %>"
                                                    class="w-full h-full object-cover transform group-hover/card:scale-110 group-hover/card:rotate-1 transition-all duration-700"
                                                    loading="lazy"
                                                    onerror="this.onerror=null; this.src='/images/fallback.png';">

                                                <!-- Cinematic Overlay -->
                                                <div
                                                    class="absolute inset-0 bg-gradient-to-t from-black via-black/20 to-transparent opacity-60 group-hover/card:opacity-90 transition-opacity duration-500">
                                                </div>

                                                <!-- Badges -->
                                                <div class="absolute top-3 left-3 flex flex-col gap-2">
                                                    <span
                                                        class="bg-red-600 text-white text-[10px] font-black px-2 py-0.5 rounded-sm uppercase tracking-tighter">HOT</span>
                                                    <% if (manga.updateStatus) { %>
                                                        <span
                                                            class="bg-purple-600 text-white text-[10px] font-black px-2 py-0.5 rounded-sm uppercase tracking-tighter">
                                                            <%= manga.updateStatus %>
                                                        </span>
                                                        <% } %>
                                                </div>

                                                <!-- Quick View Info on Hover -->
                                                <div
                                                    class="absolute inset-0 flex flex-col justify-end p-4 translate-y-4 opacity-0 group-hover/card:translate-y-0 group-hover/card:opacity-100 transition-all duration-500">
                                                    <div class="flex items-center gap-2 mb-2">
                                                        <span
                                                            class="bg-white text-black text-[10px] font-black px-2 py-0.5 rounded-sm uppercase italic">
                                                            <%= manga.genre %>
                                                        </span>

                                                    </div>
                                                    <button
                                                        class="w-full py-2 bg-white text-black text-xs font-black uppercase rounded-sm hover:bg-purple-600 hover:text-white transition-colors">Baca
                                                        Sekarang</button>
                                                </div>
                                            </div>
                                            <div class="mt-4 space-y-1">
                                                <h3
                                                    class="font-black text-white uppercase tracking-tighter text-sm line-clamp-1 group-hover/card:text-purple-400 transition-colors italic">
                                                    <%= manga.title %>
                                                </h3>
                                                <div class="flex items-center justify-between">
                                                    <span
                                                        class="text-purple-500 font-bold text-[11px] uppercase tracking-wider">
                                                        <%= manga.latestChapter?.title || 'Chapter 00' %>
                                                    </span>
                                                    <% if (manga.stats) { %>
                                                        <span
                                                            class="text-gray-600 text-[10px] font-bold uppercase tracking-widest">
                                                            <%= manga.stats.timeAgo %>
                                                        </span>
                                                        <% } %>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                    <% }); %>
                            </div>
                        </section>

                        <!-- Recommended Content (Streaming Grid) -->
                        <section class="relative group/section">
                            <div
                                class="flex flex-col md:flex-row md:items-end justify-between mb-10 gap-6 border-l-4 border-white pl-6">
                                <div>
                                    <h2 class="text-4xl font-black text-white uppercase tracking-tighter italic">
                                        Recommended
                                    </h2>
                                    <p class="text-gray-500 mt-1 font-bold text-sm tracking-widest uppercase">Pilihan
                                        editor
                                        khusus
                                        untuk kamu</p>
                                </div>

                                <div
                                    class="flex items-center gap-4 bg-primary-800/40 backdrop-blur-xl border border-white/5 p-1 rounded-sm">
                                    <div class="relative group/search">
                                        <input type="text" id="searchInput" placeholder="Cari judul..."
                                            class="bg-transparent border-none text-white text-xs font-bold px-4 py-2 w-48 focus:w-64 focus:ring-0 transition-all placeholder:text-white/20">
                                        <svg class="w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 text-white/20 group-focus-within/search:text-purple-500 transition-colors"
                                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                        </svg>
                                    </div>
                                    <div class="w-[1px] h-6 bg-white/10"></div>
                                    <a href="/popular"
                                        class="px-4 py-2 text-[10px] font-black text-white/50 hover:text-white transition-all uppercase tracking-widest">See
                                        All</a>
                                </div>
                            </div>

                            <!-- Search Results (High Contrast) -->
                            <div id="searchResults" class="hidden mb-12">
                                <div
                                    class="bg-primary-800/30 backdrop-blur-3xl border border-purple-500/20 rounded-sm p-8">
                                    <h3
                                        class="text-xl font-black text-white uppercase italic mb-8 flex items-center gap-3">
                                        <span class="w-2 h-8 bg-purple-600"></span>
                                        Found Collections
                                    </h3>
                                    <div id="searchResultsList"
                                        class="grid grid-cols-2 md:grid-cols-4 xl:grid-cols-5 gap-6"></div>
                                </div>
                            </div>

                            <!-- Premium Genre Bar -->
                            <div class="flex items-center gap-3 overflow-x-auto pb-6 scrollbar-hide no-scrollbar">
                                <a href="/genre"
                                    class="flex-shrink-0 px-6 py-2 bg-white text-black text-[10px] font-black uppercase tracking-widest hover:bg-purple-600 hover:text-white transition-all rounded-sm italic">
                                    All Genres
                                </a>
                                <% genres.forEach(genre=> { %>
                                    <a href="/genre?genre=<%= genre %>"
                                        class="flex-shrink-0 px-5 py-2 bg-white/5 border border-white/10 hover:border-purple-500/50 hover:bg-purple-600/10 text-white/60 hover:text-white text-[10px] font-black uppercase tracking-widest transition-all rounded-sm">
                                        <%= genre %>
                                    </a>
                                    <% }); %>
                            </div>

                            <div id="mangaGrid"
                                class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-5 gap-x-5 gap-y-12">
                                <% recommendations.forEach(manga=> { %>
                                    <div class="group/card relative">
                                        <a href="/manga/<%= manga.url.split('/manga/')[1].replace('/', '') %>"
                                            class="block">
                                            <div
                                                class="relative aspect-[2/3] overflow-hidden rounded-sm bg-primary-800 shadow-xl border border-white/5">
                                                <img src="<%= wsrvUrl(manga.imageUrl) %>" alt="<%= manga.title %>"
                                                    class="w-full h-full object-cover transition-transform duration-700 group-hover/card:scale-105"
                                                    loading="lazy"
                                                    onerror="this.onerror=null; this.src='/images/fallback.png';">

                                                <div
                                                    class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-60">
                                                </div>

                                                <% if (manga.isHot) { %>
                                                    <div class="absolute top-2 right-2 flex gap-1">
                                                        <span
                                                            class="bg-red-600 text-white text-[9px] font-black px-2 py-0.5 rounded-sm uppercase italic">Trending</span>
                                                    </div>
                                                    <% } %>

                                                        <div
                                                            class="absolute bottom-0 left-0 right-0 p-3 opacity-0 group-hover/card:opacity-100 transition-opacity duration-300">
                                                            <div class="flex items-center gap-2">
                                                                <span
                                                                    class="bg-purple-600 text-white text-[9px] font-black px-2 py-1 rounded-sm uppercase">
                                                                    <%= manga.genre %>
                                                                </span>
                                                            </div>
                                                        </div>
                                            </div>
                                            <div class="mt-4">
                                                <h3
                                                    class="font-black text-white uppercase tracking-tighter text-sm line-clamp-1 group-hover/card:text-purple-400 transition-colors italic">
                                                    <%= manga.title %>
                                                </h3>
                                                <div class="flex items-center gap-2 mt-1">
                                                    <span
                                                        class="text-gray-500 font-bold text-[10px] uppercase tracking-widest italic group-hover/card:text-white transition-colors">
                                                        <%= manga.latestChapter.title %>
                                                    </span>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                    <% }); %>
                            </div>
                        </section>
                    </div>

                    <!-- Sidebar (Netflix Style Top 10 / Coming Soon) -->
                    <div class="w-full lg:w-[380px] flex-shrink-0 space-y-12">

                        <!-- Trending List (Top TV Shows Style) -->
                        <section
                            class="bg-white/5 border border-white/5 p-8 rounded-sm backdrop-blur-sm relative overflow-hidden group/sidebar">
                            <div class="absolute top-0 right-0 w-32 h-32 bg-purple-600/10 blur-[60px] rounded-full">
                            </div>

                            <div class="relative z-10">
                                <div class="flex items-center justify-between mb-8">
                                    <h3 class="text-2xl font-black text-white uppercase tracking-tighter italic">Top
                                        Pick
                                    </h3>
                                    <div class="flex gap-1">
                                        <span class="w-1.5 h-1.5 rounded-full bg-purple-500"></span>
                                        <span class="w-1.5 h-1.5 rounded-full bg-gray-700"></span>
                                        <span class="w-1.5 h-1.5 rounded-full bg-gray-700"></span>
                                    </div>
                                </div>

                                <!-- Modern Tabs -->
                                <div class="flex gap-2 p-1 bg-black/40 rounded-sm mb-6 border border-white/5">
                                    <button
                                        class="popular-tab flex-1 py-2 text-[10px] font-black uppercase tracking-widest text-black bg-white italic transition-all rounded-sm"
                                        data-tab="daily">Hari Ini</button>
                                    <button
                                        class="popular-tab flex-1 py-2 text-[10px] font-black uppercase tracking-widest text-white/50 hover:text-white italic transition-all rounded-sm"
                                        data-tab="weekly">Minggu</button>
                                    <button
                                        class="popular-tab flex-1 py-2 text-[10px] font-black uppercase tracking-widest text-white/50 hover:text-white italic transition-all rounded-sm"
                                        data-tab="all">Lengkap</button>
                                </div>

                                <div id="popular-content-container" class="space-y-6">
                                    <!-- Daily Content -->
                                    <div id="popular-daily" class="popular-content space-y-5">
                                        <% popularDaily.slice(0, 5).forEach((manga, index)=> { %>
                                            <a href="/manga/<%= manga.url.split('/manga/')[1]?.replace('/', '') || '' %>"
                                                class="group/item flex gap-5 items-center">
                                                <!-- Netflix Style Numbers -->
                                                <div class="relative w-12 flex items-center justify-center">
                                                    <span
                                                        class="text-5xl font-black text-white/10 group-hover/item:text-purple-600/40 transition-colors italic leading-none transform -translate-x-2">
                                                        <%= index + 1 %>
                                                    </span>
                                                </div>
                                                <div
                                                    class="relative w-14 h-20 flex-shrink-0 overflow-hidden rounded-sm group-hover/item:ring-2 ring-purple-600 transition-all">
                                                    <img src="<%= wsrvUrl(manga.imageUrl) %>" alt="<%= manga.title %>"
                                                        class="w-full h-full object-cover">
                                                </div>
                                                <div class="flex-1 min-w-0">
                                                    <h4
                                                        class="font-black text-white uppercase text-xs tracking-tighter line-clamp-2 group-hover/item:text-purple-400 transition-colors italic">
                                                        <%= manga.title %>
                                                    </h4>
                                                    <div class="flex items-center gap-2 mt-2">
                                                        <span
                                                            class="text-[9px] font-black text-purple-500 uppercase tracking-widest italic">
                                                            <%= manga.latestChapter?.title || 'NEW' %>
                                                        </span>
                                                        <span class="w-1 h-1 rounded-full bg-white/10"></span>
                                                        <span
                                                            class="text-[9px] font-bold text-gray-500 uppercase tracking-widest">
                                                            <%= manga.genre %>
                                                        </span>
                                                    </div>
                                                </div>
                                            </a>
                                            <% }); %>
                                    </div>

                                    <!-- Weekly (Hidden Initially) -->
                                    <div id="popular-weekly" class="popular-content hidden space-y-5">
                                        <% popularWeekly.slice(0, 5).forEach((manga, index)=> { %>
                                            <a href="/manga/<%= manga.url.split('/manga/')[1]?.replace('/', '') || '' %>"
                                                class="group/item flex gap-5 items-center">
                                                <div
                                                    class="relative w-12 flex items-center justify-center text-5xl font-black text-white/10 italic leading-none transform -translate-x-2">
                                                    <%= index + 1 %>
                                                </div>
                                                <div
                                                    class="relative w-14 h-20 flex-shrink-0 overflow-hidden rounded-sm">
                                                    <img src="<%= wsrvUrl(manga.imageUrl) %>" alt="<%= manga.title %>"
                                                        class="w-full h-full object-cover">
                                                </div>
                                                <div class="flex-1 min-w-0">
                                                    <h4
                                                        class="font-black text-white uppercase text-xs tracking-tighter line-clamp-2 italic">
                                                        <%= manga.title %>
                                                    </h4>
                                                    <p
                                                        class="text-[9px] font-black text-purple-500 uppercase tracking-widest italic mt-2">
                                                        <%= manga.latestChapter?.title || 'NEW' %>
                                                    </p>
                                                </div>
                                            </a>
                                            <% }); %>
                                    </div>

                                    <!-- All Time (Hidden Initially) -->
                                    <div id="popular-all" class="popular-content hidden space-y-5">
                                        <% popularAll.slice(0, 5).forEach((manga, index)=> { %>
                                            <a href="/manga/<%= manga.url.split('/manga/')[1]?.replace('/', '') || '' %>"
                                                class="group/item flex gap-5 items-center">
                                                <div
                                                    class="relative w-12 flex items-center justify-center text-5xl font-black text-white/10 italic leading-none transform -translate-x-2">
                                                    <%= index + 1 %>
                                                </div>
                                                <div
                                                    class="relative w-14 h-20 flex-shrink-0 overflow-hidden rounded-sm">
                                                    <img src="<%= wsrvUrl(manga.imageUrl) %>" alt="<%= manga.title %>"
                                                        class="w-full h-full object-cover">
                                                </div>
                                                <div class="flex-1 min-w-0">
                                                    <h4
                                                        class="font-black text-white uppercase text-xs tracking-tighter line-clamp-2 italic">
                                                        <%= manga.title %>
                                                    </h4>
                                                    <p
                                                        class="text-[9px] font-black text-purple-500 uppercase tracking-widest italic mt-2">
                                                        <%= manga.latestChapter?.title || 'NEW' %>
                                                    </p>
                                                </div>
                                            </a>
                                            <% }); %>
                                    </div>
                                </div>

                                <a href="/popular"
                                    class="block w-full text-center mt-10 py-3 border border-white/5 hover:bg-white/5 text-[10px] font-black uppercase tracking-[0.3em] text-white/30 hover:text-white transition-all italic">Lihat
                                    Selengkapnya</a>
                            </div>
                        </section>

                        <!-- Latest Releases (Multi-Source with Cover Images) -->
                        <section class="bg-white/5 border border-white/5 p-6 md:p-8 rounded-sm">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl md:text-2xl font-black text-white uppercase tracking-tighter italic">
                                    Updates</h3>
                                <div class="flex items-center gap-2">
                                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                                    <span
                                        class="text-[9px] font-bold text-white/40 uppercase tracking-widest">Live</span>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <% latestManga.slice(0, 8).forEach(manga=> { %>
                                    <a href="<%= manga.url.startsWith('/') ? manga.url : '/manga/' + (manga.url.split('/manga/')[1]?.replace('/', '') || '') %>"
                                        class="group/update flex items-center gap-3 p-3 -mx-3 hover:bg-white/[0.03] rounded-sm transition-all border-b border-white/5 last:border-0">

                                        <!-- Cover Image -->
                                        <div
                                            class="relative w-12 h-16 flex-shrink-0 overflow-hidden rounded-sm bg-white/5">
                                            <img src="<%= manga.imageUrl %>" alt="<%= manga.title %>"
                                                class="w-full h-full object-cover transition-transform duration-500 group-hover/update:scale-110"
                                                onerror="this.src='/assets/fallback.png'">
                                            <!-- Source Badge -->
                                            <div class="absolute bottom-0 left-0 right-0">
                                                <% if (manga.source==='international' ) { %>
                                                    <span
                                                        class="block w-full text-center bg-blue-600 text-white text-[7px] font-black uppercase tracking-wider py-0.5">EN</span>
                                                    <% } else { %>
                                                        <span
                                                            class="block w-full text-center bg-red-600 text-white text-[7px] font-black uppercase tracking-wider py-0.5">ID</span>
                                                        <% } %>
                                            </div>
                                        </div>

                                        <!-- Content -->
                                        <div class="flex-1 min-w-0">
                                            <h4
                                                class="font-black text-white text-xs uppercase tracking-tight line-clamp-1 group-hover/update:text-purple-400 transition-colors">
                                                <%= manga.title %>
                                            </h4>
                                            <p
                                                class="text-[10px] font-bold text-purple-400/80 mt-1 uppercase tracking-wider line-clamp-1">
                                                <%= manga.latestChapter?.title || 'Chapter Update' %>
                                            </p>
                                            <div class="flex items-center gap-2 mt-1.5">
                                                <span
                                                    class="text-[9px] font-bold text-white/30 uppercase tracking-wider">
                                                    <%= manga.timeAgo || 'Baru' %>
                                                </span>
                                                <% if (manga.type) { %>
                                                    <span class="w-1 h-1 rounded-full bg-white/20"></span>
                                                    <span class="text-[9px] font-bold text-white/20 uppercase">
                                                        <%= manga.type %>
                                                    </span>
                                                    <% } %>
                                            </div>
                                        </div>

                                        <!-- Arrow Icon -->
                                        <svg class="w-4 h-4 text-white/20 group-hover/update:text-purple-400 group-hover/update:translate-x-1 transition-all flex-shrink-0"
                                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M9 5l7 7-7 7" />
                                        </svg>
                                    </a>
                                    <% }); %>
                            </div>
                            <a href="/latest"
                                class="flex items-center justify-center gap-2 w-full mt-6 py-3 text-[10px] font-black uppercase tracking-widest text-purple-500 hover:text-white hover:bg-purple-600/20 border border-purple-500/20 rounded-sm transition-all">
                                <span>View All Updates</span>
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M17 8l4 4m0 0l-4 4m4-4H3" />
                                </svg>
                            </a>
                        </section>

                        <!-- Cinematic Genre Explorer -->
                        <section
                            class="bg-gradient-to-br from-purple-900/40 to-black p-8 border border-white/5 rounded-sm">
                            <h3 class="text-xl font-black text-white uppercase tracking-tighter italic mb-6">Explore
                                Genres
                            </h3>
                            <div class="flex flex-wrap gap-2">
                                <% ['Action', 'Romance' , 'Fantasy' , 'Comedy' , 'Drama' , 'Isekai' , 'Horror'
                                    , 'Martial Arts' ].forEach(genre=> { %>
                                    <a href="/genre?genre=<%= genre %>"
                                        class="px-3 py-1.5 bg-black/40 border border-white/10 hover:border-purple-500 hover:bg-purple-600/20 text-white/50 hover:text-white rounded-sm text-[10px] font-black uppercase tracking-widest transition-all italic">
                                        <%= genre %>
                                    </a>
                                    <% }); %>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Homepage Data Cache System -->
<script id="homepageCacheData" type="application/json">
<%- JSON.stringify({
    recommendations: recommendations,
    hotManga: hotManga,
    latestManga: latestManga,
    popularDaily: popularDaily,
    popularWeekly: popularWeekly,
    popularAll: popularAll,
    genres: genres,
    cachedAt: Date.now()
}) %>
</script>

<script>
    (function () {
        const CACHE_KEY = 'komikkuya_homepage_cache';
        const CACHE_DURATION = 60 * 60 * 1000; // 1 hour in milliseconds

        // Get current page data
        const pageDataEl = document.getElementById('homepageCacheData');
        if (pageDataEl) {
            try {
                const pageData = JSON.parse(pageDataEl.textContent);
                // Save to localStorage with timestamp
                localStorage.setItem(CACHE_KEY, JSON.stringify({
                    data: pageData,
                    timestamp: Date.now()
                }));
                console.log(' Homepage data cached to localStorage');
            } catch (e) {
                console.warn('Failed to cache homepage data:', e);
            }
        }

        // Show cache status indicator (optional - for debugging)
        function showCacheStatus() {
            const cached = localStorage.getItem(CACHE_KEY);
            if (cached) {
                try {
                    const { timestamp } = JSON.parse(cached);
                    const age = Date.now() - timestamp;
                    const ageMinutes = Math.floor(age / 60000);
                    const isValid = age < CACHE_DURATION;
                    console.log(` Cache age: ${ageMinutes} minutes (${isValid ? 'valid' : 'expired'})`);
                } catch (e) { }
            }
        }
        showCacheStatus();
    })();
</script>

<script>
    // Notification Popup
    function showNotificationPopup() {
        const popup = document.getElementById('notificationPopup');
        popup.classList.remove('hidden');
        // Trigger reflow for transition
        void popup.offsetWidth;
        popup.classList.remove('opacity-0');
    }

    function closeNotificationPopup() {
        const popup = document.getElementById('notificationPopup');
        popup.classList.add('opacity-0');
        setTimeout(() => {
            popup.classList.add('hidden');
        }, 500); // Wait for transition duration
        localStorage.setItem('notificationPopupClosed', new Date().getTime());
    }

    document.addEventListener('DOMContentLoaded', function () {
        const lastClosed = localStorage.getItem('notificationPopupClosed');
        const now = new Date().getTime();
        const oneMinute = 1 * 1 * 1000;

        if (!lastClosed || (now - parseInt(lastClosed)) > oneMinute) {
            setTimeout(() => {
                showNotificationPopup();
            }, 500);
        }

        // Cinematic Hero Carousel (Netflix/Crunchyroll Style)
        const heroCarousel = document.getElementById('heroCarousel');
        const slides = heroCarousel.querySelectorAll('.hero-slide');
        const dots = heroCarousel.querySelectorAll('.carousel-dot');
        const prevBtn = document.getElementById('heroPrev');
        const nextBtn = document.getElementById('heroNext');
        let currentSlide = 0;
        let interval;
        let progressInterval;
        const SLIDE_DURATION = 8000; // 8 seconds for cinematic feel
        const PROGRESS_UPDATE_INTERVAL = 40;

        function updateProgress() {
            let progress = 0;
            if (progressInterval) clearInterval(progressInterval);

            const currentFill = dots[currentSlide].querySelector('.progress-fill');

            progressInterval = setInterval(() => {
                progress += (PROGRESS_UPDATE_INTERVAL / SLIDE_DURATION) * 100;
                if (currentFill) {
                    currentFill.style.height = Math.min(progress, 100) + '%';
                }
                if (progress >= 100) {
                    clearInterval(progressInterval);
                }
            }, PROGRESS_UPDATE_INTERVAL);
        }

        function changeSlide(index) {
            // Reset indicators
            dots.forEach(dot => {
                const fill = dot.querySelector('.progress-fill');
                const indicatorBar = dot.querySelector('.relative');
                if (fill) fill.style.height = '0%';
                if (indicatorBar) {
                    indicatorBar.classList.remove('h-24', 'bg-white/20');
                    indicatorBar.classList.add('h-16', 'bg-white/5');
                }
            });

            // Slide transitions
            slides.forEach(slide => {
                slide.classList.remove('opacity-100', 'z-10');
                slide.classList.add('opacity-0', 'z-0');

                const img = slide.querySelector('.hero-img');
                if (img) img.classList.remove('scale-110');

                const content = slide.querySelector('.hero-content-box');
                if (content) {
                    content.classList.remove('translate-y-0', 'opacity-100');
                    content.classList.add('translate-y-16', 'opacity-0');
                }
            });

            slides[index].classList.remove('opacity-0', 'z-0');
            slides[index].classList.add('opacity-100', 'z-10');

            // Re-trigger animations
            const activeImg = slides[index].querySelector('.hero-img');
            if (activeImg) {
                setTimeout(() => activeImg.classList.add('scale-110'), 50);
            }

            const activeContent = slides[index].querySelector('.hero-content-box');
            if (activeContent) {
                setTimeout(() => {
                    activeContent.classList.remove('translate-y-16', 'opacity-0');
                    activeContent.classList.add('translate-y-0', 'opacity-100');
                }, 300);
            }

            const activeBar = dots[index].querySelector('.relative');
            if (activeBar) {
                activeBar.classList.remove('h-16', 'bg-white/5');
                activeBar.classList.add('h-24', 'bg-white/20');
            }

            currentSlide = index;
            updateProgress();
        }

        function nextSlide() {
            const next = (currentSlide + 1) % slides.length;
            changeSlide(next);
        }

        function prevSlide() {
            const prev = (currentSlide - 1 + slides.length) % slides.length;
            changeSlide(prev);
        }

        function startAutoAdvance() {
            interval = setInterval(nextSlide, SLIDE_DURATION);
            updateProgress();
        }

        function stopAutoAdvance() {
            clearInterval(interval);
            clearInterval(progressInterval);
        }

        if (prevBtn) prevBtn.addEventListener('click', () => { stopAutoAdvance(); prevSlide(); startAutoAdvance(); });
        if (nextBtn) nextBtn.addEventListener('click', () => { stopAutoAdvance(); nextSlide(); startAutoAdvance(); });

        dots.forEach(dot => {
            dot.addEventListener('click', () => {
                const index = parseInt(dot.getAttribute('data-index'));
                stopAutoAdvance();
                changeSlide(index);
                startAutoAdvance();
            });
        });

        // Touch Swipe
        let touchStart = 0;
        heroCarousel.addEventListener('touchstart', (e) => { touchStart = e.changedTouches[0].screenX; }, { passive: true });
        heroCarousel.addEventListener('touchend', (e) => {
            const diff = touchStart - e.changedTouches[0].screenX;
            if (Math.abs(diff) > 50) {
                stopAutoAdvance();
                if (diff > 0) nextSlide(); else prevSlide();
                startAutoAdvance();
            }
        }, { passive: true });

        // Ken Burns and Content animation for first slide
        setTimeout(() => {
            const firstImg = slides[0].querySelector('.hero-img');
            if (firstImg) firstImg.classList.add('scale-110');

            const firstContent = slides[0].querySelector('.hero-content-box');
            if (firstContent) {
                firstContent.classList.remove('translate-y-16', 'opacity-0');
                firstContent.classList.add('translate-y-0', 'opacity-100');
            }
            updateProgress();
        }, 200);

        startAutoAdvance();

        // Popular tabs with streaming style switching
        const popularTabs = document.querySelectorAll('.popular-tab');
        const popularContents = document.querySelectorAll('.popular-content');

        popularTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.getAttribute('data-tab');

                // Update active tab styles (Streaming style: Black text on White bg)
                popularTabs.forEach(t => {
                    t.classList.remove('text-black', 'bg-white');
                    t.classList.add('text-white/50');
                });
                tab.classList.remove('text-white/50');
                tab.classList.add('text-black', 'bg-white');

                // Update content focus
                popularContents.forEach(content => content.classList.add('hidden'));
                document.getElementById(`popular-${tabName}`).classList.remove('hidden');
            });
        });
    });

    // Search functionality
    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');
    const searchResultsList = document.getElementById('searchResultsList');
    const mangaGrid = document.getElementById('mangaGrid');
    let searchTimeout;

    searchInput.addEventListener('input', (e) => {
        clearTimeout(searchTimeout);
        const query = e.target.value.trim();

        if (query.length < 2) {
            searchResults.classList.add('hidden');
            mangaGrid.classList.remove('hidden');
            return;
        }

        // Show loading immediately
        searchResultsList.innerHTML = `
            <div class="col-span-full text-center py-12">
                <div class="flex justify-center items-center space-x-2 mb-4">
                    <div class="w-3 h-3 bg-purple-500 rounded-full animate-bounce" style="animation-delay: 0ms;"></div>
                    <div class="w-3 h-3 bg-purple-500 rounded-full animate-bounce" style="animation-delay: 150ms;"></div>
                    <div class="w-3 h-3 bg-purple-500 rounded-full animate-bounce" style="animation-delay: 300ms;"></div>
                </div>
                <p class="text-sm text-gray-400">Searching across all sources...</p>
                <p class="text-xs text-gray-500 mt-1">Komiku  Asia  International</p>
            </div>
        `;
        searchResults.classList.remove('hidden');
        mangaGrid.classList.add('hidden');

        searchTimeout = setTimeout(async () => {
            try {
                const response = await fetch(`/api/search?query=${encodeURIComponent(query)}`);
                const data = await response.json();

                if (data.success && data.data.length > 0) {
                    searchResultsList.innerHTML = data.data.map(manga => {
                        // Handle different URL formats from Komiku, Asia, and International APIs
                        let mangaSlug = '';
                        if (manga.mangaUrl) {
                            if (manga.mangaUrl.includes('/manga/')) {
                                mangaSlug = manga.mangaUrl.split('/manga/')[1]?.replace('/', '') || '';
                            } else if (manga.mangaUrl.includes('/comic/')) {
                                // Asia API uses /comic/ instead of /manga/
                                mangaSlug = manga.mangaUrl.split('/comic/')[1]?.replace('/', '') || '';
                            } else if (manga.mangaUrl.includes('/series/')) {
                                // International API uses /series/ID/slug
                                const urlParts = manga.mangaUrl.split('/').filter(p => p);
                                mangaSlug = urlParts[urlParts.length - 1] || '';
                            } else if (manga.slug) {
                                mangaSlug = manga.slug;
                            } else {
                                // Extract last part of URL as slug
                                const urlParts = manga.mangaUrl.split('/').filter(p => p);
                                mangaSlug = urlParts[urlParts.length - 1] || '';
                            }
                        } else if (manga.slug) {
                            mangaSlug = manga.slug;
                        }

                        // Determine badge based on source
                        let sourceBadge = '';
                        if (manga.source === 'asia') {
                            sourceBadge = '<div class="absolute top-2 right-2 bg-blue-500 text-white text-xs px-2 py-1 rounded-full">Asia</div>';
                        } else if (manga.source === 'international') {
                            sourceBadge = '<div class="absolute top-2 right-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full">EN</div>';
                        }

                        return `
                        <div class="group/card relative">
                            <a href="/manga/${mangaSlug}" class="block">
                                <div class="relative aspect-[2/3] overflow-hidden rounded-sm bg-primary-800 shadow-xl border border-white/5">
                                    <img src="${manga.imageUrl}" alt="${manga.title}" 
                                         class="w-full h-full object-cover transform group-hover/card:scale-105 transition-transform duration-700" 
                                         onerror="this.onerror=null; this.src='/images/fallback.png';">
                                    
                                    <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-60"></div>
                                    
                                    ${sourceBadge}

                                    <div class="absolute bottom-0 left-0 right-0 p-3 opacity-0 group-hover/card:opacity-100 transition-opacity duration-300">
                                        <div class="flex items-center gap-2">
                                            <span class="bg-purple-600 text-white text-[9px] font-black px-2 py-1 rounded-sm uppercase italic">${manga.type || 'Manga'}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <h3 class="font-black text-white uppercase tracking-tighter text-xs line-clamp-1 group-hover/card:text-purple-400 transition-colors italic">
                                        ${manga.title}
                                    </h3>
                                    <div class="flex items-center gap-2 mt-1">
                                        <span class="text-gray-500 font-bold text-[9px] uppercase tracking-widest italic">
                                            ${manga.latestChapter?.title || manga.status || 'NEW'}
                                        </span>
                                    </div>
                                </div>
                            </a>
                        </div>
                    `}).join('');

                    searchResults.classList.remove('hidden');
                    mangaGrid.classList.add('hidden');
                } else {
                    searchResultsList.innerHTML = `
                        <div class="col-span-full text-center py-8">
                            <p class="text-gray-400">No manga found for "${query}"</p>
                        </div>
                    `;
                    searchResults.classList.remove('hidden');
                    mangaGrid.classList.add('hidden');
                }
            } catch (error) {
                console.error('Error searching manga:', error);
                searchResultsList.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <p class="text-red-400">Error searching manga. Please try again.</p>
                    </div>
                `;
                searchResults.classList.remove('hidden');
                mangaGrid.classList.add('hidden');
            }
        }, 500);
    });
</script>

<%- include('partials/lazyload') %>