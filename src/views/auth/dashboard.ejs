<div class="relative min-h-screen bg-primary-950 overflow-hidden">
    <!-- Background Ambient Glows -->
    <div
        class="absolute top-0 right-0 -translate-y-1/2 translate-x-1/2 w-[800px] h-[800px] bg-purple-600/10 blur-[120px] rounded-full pointer-events-none">
    </div>
    <div
        class="absolute bottom-0 left-0 translate-y-1/2 -translate-x-1/2 w-[600px] h-[600px] bg-purple-900/10 blur-[100px] rounded-full pointer-events-none">
    </div>

    <div class="max-w-4xl mx-auto px-6 py-32 relative z-10">
        <!-- Header -->
        <div class="text-center mb-16">
            <div
                class="flex items-center justify-center gap-3 text-purple-500 font-black tracking-[0.3em] uppercase text-xs mb-4">
                <span class="w-12 h-[2px] bg-purple-500"></span>
                AKUN KAMU
                <span class="w-12 h-[2px] bg-purple-500"></span>
            </div>
            <h1 class="text-5xl md:text-6xl font-black text-white italic tracking-tighter uppercase">
                Dashboard
            </h1>
        </div>

        <!-- Messages -->
        <% if (typeof error !=='undefined' && error) { %>
            <div class="mb-6 p-4 bg-red-500/20 border border-red-500/30 rounded-sm">
                <p class="text-red-400 text-sm font-bold text-center">
                    <%= error %>
                </p>
            </div>
            <% } %>
                <% if (typeof success !=='undefined' && success) { %>
                    <div class="mb-6 p-4 bg-green-500/20 border border-green-500/30 rounded-sm">
                        <p class="text-green-400 text-sm font-bold text-center">
                            <%= success %>
                        </p>
                    </div>
                    <% } %>

                        <div class="grid md:grid-cols-3 gap-8">
                            <!-- Profile Card -->
                            <div class="md:col-span-1">
                                <div class="bg-white/5 border border-white/10 rounded-sm p-8 text-center">
                                    <!-- Profile Picture -->
                                    <div class="relative inline-block mb-6">
                                        <div
                                            class="w-32 h-32 rounded-full overflow-hidden border-4 border-purple-500/50 mx-auto bg-white/10">
                                            <% if (user.profile_picture_url) { %>
                                                <img src="<%= user.profile_picture_url %>" alt="Profile"
                                                    class="w-full h-full object-cover">
                                                <% } else { %>
                                                    <div
                                                        class="w-full h-full flex items-center justify-center text-4xl font-black text-white/40 uppercase">
                                                        <%= user.username.charAt(0) %>
                                                    </div>
                                                    <% } %>
                                        </div>
                                    </div>

                                    <h2 class="text-xl font-black text-white uppercase tracking-tight italic">
                                        <%= user.username %>
                                    </h2>
                                    <p class="text-white/40 text-sm mt-1">
                                        <%= user.email %>
                                    </p>

                                    <!-- Profile Picture Upload -->
                                    <form action="/auth/profile-picture" method="POST" enctype="multipart/form-data"
                                        class="mt-6">
                                        <label for="profile-pic"
                                            class="block w-full py-3 px-4 bg-white/5 border border-white/10 rounded-sm text-[10px] font-black text-white/60 uppercase tracking-widest cursor-pointer hover:bg-white/10 transition-colors">
                                            <span id="file-label">Pilih Foto</span>
                                            <input type="file" id="profile-pic" name="file" accept="image/*"
                                                class="hidden"
                                                onchange="document.getElementById('file-label').textContent = this.files[0]?.name || 'Pilih Foto'">
                                        </label>
                                        <button type="submit"
                                            class="w-full mt-2 py-2 bg-purple-600/30 hover:bg-purple-600 text-white text-[10px] font-black uppercase tracking-widest rounded-sm transition-all">
                                            Upload Foto
                                        </button>
                                    </form>

                                    <% if (user.profile_picture) { %>
                                        <form action="/auth/delete-profile-picture" method="POST" class="mt-2">
                                            <button type="submit"
                                                class="w-full py-2 bg-red-600/20 hover:bg-red-600 text-red-400 hover:text-white text-[10px] font-black uppercase tracking-widest rounded-sm transition-all">
                                                Hapus Foto
                                            </button>
                                        </form>
                                        <% } %>

                                            <!-- Logout Button -->
                                            <a href="/auth/logout"
                                                class="block w-full mt-8 py-3 border border-white/10 hover:border-red-500/50 text-white/40 hover:text-red-400 text-[10px] font-black uppercase tracking-widest rounded-sm transition-all text-center">
                                                Logout
                                            </a>
                                </div>
                            </div>

                            <!-- Edit Profile -->
                            <div class="md:col-span-2">
                                <div class="bg-white/5 border border-white/10 rounded-sm p-8">
                                    <h3 class="text-lg font-black text-white uppercase tracking-tight italic mb-8">Edit
                                        Profil</h3>

                                    <form action="/auth/profile" method="POST" class="space-y-6">
                                        <div class="space-y-2">
                                            <label for="edit-username"
                                                class="block text-[10px] font-black text-white/40 uppercase tracking-[0.2em]">Username</label>
                                            <input type="text" id="edit-username" name="username"
                                                value="<%= user.username %>" required
                                                class="w-full bg-white/5 border border-white/10 rounded-sm px-4 py-4 text-white font-bold placeholder:text-white/20 focus:outline-none focus:border-purple-500 transition-colors">
                                        </div>

                                        <div class="space-y-2">
                                            <label for="edit-email"
                                                class="block text-[10px] font-black text-white/40 uppercase tracking-[0.2em]">Email</label>
                                            <input type="email" id="edit-email" name="email" value="<%= user.email %>"
                                                required
                                                class="w-full bg-white/5 border border-white/10 rounded-sm px-4 py-4 text-white font-bold placeholder:text-white/20 focus:outline-none focus:border-purple-500 transition-colors">
                                        </div>

                                        <button type="submit"
                                            class="w-full py-4 bg-purple-600 hover:bg-purple-700 text-white font-black uppercase text-sm tracking-widest rounded-sm transition-all shadow-[0_10px_40px_rgba(147,51,234,0.3)] hover:-translate-y-0.5">
                                            Simpan Perubahan
                                        </button>
                                    </form>
                                </div>

                                <!-- Privacy Settings -->
                                <div class="bg-white/5 border border-white/10 rounded-sm p-8 mt-8">
                                    <h3 class="text-lg font-black text-white uppercase tracking-tight italic mb-6">
                                        Privacy Settings</h3>

                                    <div class="space-y-4">
                                        <!-- Show Favorites Toggle -->
                                        <div
                                            class="flex items-center justify-between p-4 bg-white/5 border border-white/10 rounded-sm">
                                            <div>
                                                <p class="text-sm font-bold text-white">Tampilkan Favorites</p>
                                                <p class="text-[10px] text-white/40 mt-1">Izinkan orang lain melihat
                                                    daftar favorites kamu</p>
                                            </div>
                                            <button id="toggle-favorites" onclick="toggleSetting('show_favorites')"
                                                class="relative w-12 h-6 bg-white/10 rounded-full transition-colors duration-300">
                                                <span id="toggle-favorites-dot"
                                                    class="absolute left-1 top-1 w-4 h-4 bg-white/40 rounded-full transition-all duration-300"></span>
                                            </button>
                                        </div>

                                        <!-- Show Reading History Toggle -->
                                        <div
                                            class="flex items-center justify-between p-4 bg-white/5 border border-white/10 rounded-sm">
                                            <div>
                                                <p class="text-sm font-bold text-white">Tampilkan Riwayat Baca</p>
                                                <p class="text-[10px] text-white/40 mt-1">Izinkan orang lain melihat
                                                    riwayat bacaan kamu</p>
                                            </div>
                                            <button id="toggle-history" onclick="toggleSetting('show_reading_history')"
                                                class="relative w-12 h-6 bg-white/10 rounded-full transition-colors duration-300">
                                                <span id="toggle-history-dot"
                                                    class="absolute left-1 top-1 w-4 h-4 bg-white/40 rounded-full transition-all duration-300"></span>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Discord Integration -->
                                <div class="bg-white/5 border border-white/10 rounded-sm p-8 mt-8">
                                    <h3 class="text-lg font-black text-white uppercase tracking-tight italic mb-6">
                                        Discord Integration</h3>

                                    <% if (locals.discord) { %>
                                        <!-- Discord Linked - Full Profile -->
                                        <div class="relative border border-indigo-500/30 rounded-sm overflow-hidden">
                                            <% if (discord.banner) { %>
                                                <!-- Banner Background -->
                                                <div class="absolute inset-0 z-0">
                                                    <img src="<%= discord.banner %>" alt="Banner"
                                                        class="w-full h-full object-cover">
                                                    <div
                                                        class="absolute inset-0 bg-gradient-to-b from-black/40 via-primary-950/80 to-primary-950">
                                                    </div>
                                                </div>
                                                <% } else { %>
                                                    <!-- Default Gradient Background -->
                                                    <div
                                                        class="absolute inset-0 z-0 bg-gradient-to-br from-indigo-900/30 to-purple-900/20">
                                                    </div>
                                                    <% } %>
                                                        <!-- Profile Header -->
                                                        <div class="relative z-10 p-6">
                                                            <% const statusColors={ 'online' : 'bg-green-500' , 'idle'
                                                                : 'bg-yellow-500' , 'dnd' : 'bg-red-500' , 'offline'
                                                                : 'bg-gray-500' }; const
                                                                statusColor=statusColors[discord.status]
                                                                || 'bg-gray-500' ; %>

                                                                <div class="flex items-start gap-5">
                                                                    <!-- Avatar with Decoration & Status -->
                                                                    <div class="relative flex-shrink-0"
                                                                        style="width: 90px; height: 90px;">
                                                                        <div
                                                                            class="absolute inset-[10px] rounded-full overflow-hidden border-2 border-indigo-500/50">
                                                                            <img src="<%= discord.avatar %>"
                                                                                alt="<%= discord.display_name %>"
                                                                                class="w-full h-full object-cover">
                                                                        </div>
                                                                        <% if (discord.avatar_decoration) { %>
                                                                            <img src="<%= discord.avatar_decoration %>"
                                                                                alt="Decoration"
                                                                                class="absolute inset-0 w-full h-full object-contain pointer-events-none">
                                                                            <% } %>
                                                                                <!-- Status Dot on Avatar -->
                                                                                <div
                                                                                    class="absolute bottom-2 right-2 w-5 h-5 rounded-full <%= statusColor %> border-[3px] border-primary-950">
                                                                                </div>
                                                                    </div>

                                                                    <!-- User Info -->
                                                                    <div class="flex-1">
                                                                        <div class="flex items-center gap-2 flex-wrap">
                                                                            <h4 class="text-xl font-black text-white">
                                                                                <%= discord.display_name ||
                                                                                    discord.global_name ||
                                                                                    discord.username %>
                                                                            </h4>
                                                                            <% if (discord.clan && discord.clan.badge) {
                                                                                %>
                                                                                <div
                                                                                    class="flex items-center gap-1.5 bg-white/10 px-2 py-1 rounded-sm">
                                                                                    <img src="<%= discord.clan.badge %>"
                                                                                        alt="<%= discord.clan.tag %>"
                                                                                        class="w-4 h-4">
                                                                                    <span
                                                                                        class="text-[10px] font-bold text-white/80">
                                                                                        <%= discord.clan.tag %>
                                                                                    </span>
                                                                                </div>
                                                                                <% } %>
                                                                                    <span
                                                                                        class="text-green-400 text-[8px] font-black uppercase tracking-widest bg-green-500/20 px-2 py-0.5 rounded-sm">Connected</span>
                                                                        </div>
                                                                        <p class="text-sm text-white/40 mt-1">@<%=
                                                                                discord.username %>
                                                                        </p>
                                                                    </div>
                                                                </div>
                                                        </div>

                                                        <% if (discord.activities && discord.activities.length> 0) { %>
                                                            <!-- Activities -->
                                                            <div class="border-t border-white/10 p-4 space-y-3">
                                                                <p
                                                                    class="text-[10px] font-black text-white/40 uppercase tracking-widest">
                                                                    Current Activity</p>
                                                                <% discord.activities.forEach(function(activity) { %>
                                                                    <div
                                                                        class="flex items-center gap-4 p-3 bg-black/20 rounded-sm">
                                                                        <% if (activity.assets &&
                                                                            activity.assets.large_image) { %>
                                                                            <% let
                                                                                largeImgUrl=activity.assets.large_image;
                                                                                if (largeImgUrl.startsWith('mp:')) {
                                                                                largeImgUrl='https://media.discordapp.net/'
                                                                                + largeImgUrl.replace('mp:', '' ); }
                                                                                else {
                                                                                largeImgUrl='https://cdn.discordapp.com/app-assets/'
                                                                                + activity.application_id + '/' +
                                                                                largeImgUrl + '.png' ; } let
                                                                                smallImgUrl='' ; if
                                                                                (activity.assets.small_image) { if
                                                                                (activity.assets.small_image.startsWith('mp:'))
                                                                                {
                                                                                smallImgUrl='https://media.discordapp.net/'
                                                                                +
                                                                                activity.assets.small_image.replace('mp:', ''
                                                                                ); } else {
                                                                                smallImgUrl='https://cdn.discordapp.com/app-assets/'
                                                                                + activity.application_id + '/' +
                                                                                activity.assets.small_image + '.png' ; }
                                                                                } %>
                                                                                <div
                                                                                    class="relative w-14 h-14 rounded-sm overflow-hidden flex-shrink-0">
                                                                                    <img src="<%= largeImgUrl %>"
                                                                                        alt="<%= activity.assets.large_text || activity.name %>"
                                                                                        class="w-full h-full object-cover"
                                                                                        onerror="this.style.display='none'">
                                                                                    <% if (smallImgUrl) { %>
                                                                                        <img src="<%= smallImgUrl %>"
                                                                                            alt="<%= activity.assets.small_text %>"
                                                                                            class="absolute -bottom-1 -right-1 w-6 h-6 rounded-full border-2 border-primary-950"
                                                                                            onerror="this.style.display='none'">
                                                                                        <% } %>
                                                                                </div>
                                                                                <% } %>
                                                                                    <div class="flex-1 min-w-0">
                                                                                        <p
                                                                                            class="text-sm font-bold text-white truncate">
                                                                                            <%= activity.name %>
                                                                                        </p>
                                                                                        <% if (activity.details) { %>
                                                                                            <p
                                                                                                class="text-[11px] text-white/60 truncate">
                                                                                                <%= activity.details %>
                                                                                            </p>
                                                                                            <% } %>
                                                                                                <% if (activity.state) {
                                                                                                    %>
                                                                                                    <p
                                                                                                        class="text-[11px] text-white/40 truncate">
                                                                                                        <%= activity.state
                                                                                                            %>
                                                                                                    </p>
                                                                                                    <% } %>
                                                                                    </div>
                                                                    </div>
                                                                    <% }); %>
                                                            </div>
                                                            <% } %>
                                        </div>
                                        <p class="text-[10px] text-green-400/60 mt-4">
                                            ✓ Discord sudah terhubung. Kamu bisa login menggunakan Discord.
                                        </p>
                                        <% } else { %>
                                            <!-- Discord Not Linked -->
                                            <div
                                                class="flex items-center justify-between p-4 bg-white/5 border border-white/10 rounded-sm">
                                                <div class="flex items-center gap-4">
                                                    <div
                                                        class="w-12 h-12 bg-indigo-600/20 rounded-full flex items-center justify-center">
                                                        <svg class="w-6 h-6 text-indigo-400" viewBox="0 0 24 24"
                                                            fill="currentColor">
                                                            <path
                                                                d="M19.27 4.57c-1.41-.65-3-1.12-4.66-1.37a.066.066 0 0 0-.07.03c-.2.36-.42.82-.58 1.21-1.78-.27-3.56-.27-5.3 0-.16-.39-.39-0.85-.59-1.21a.066.066 0 0 0-.07-.03c-1.66.25-3.25.72-4.66 1.37a.064.064 0 0 0-.03.02C.53 8.35-.29 12 0.08 15.65c.02.04.05.08.08.11 2.05 1.51 3.99 2.43 5.92 3.03a.065.065 0 0 0 .07-.02c.46-.63.87-1.3 1.22-2a.064.064 0 0 0-.03-.09c-.65-.25-1.27-.56-1.85-.92a.063.063 0 0 1-.01-.1c.12-.09.25-.19.37-.29a.06.06 0 0 1 .06-.01c3.87 1.77 8.06 1.77 11.89 0a.06.06 0 0 1 .06.01c.12.1.25.19.37.29a.063.063 0 0 1-.01.1c-.58.35-1.2.66-1.85.92a.064.064 0 0 0-.03.09c.35.7.75 1.37 1.22 2a.064.064 0 0 0 .07.02c1.94-.61 3.88-1.53 5.93-3.04a.06.06 0 0 0 .07-.1c.45-4.22-.76-7.85-3.01-11.08a.047.047 0 0 0-.04-.02ZM8.17 13.06c-1.14 0-2.08-1.05-2.08-2.33s.92-2.33 2.08-2.33 2.08 1.05 2.08 2.33-0.93 2.33-2.08 2.33Zm7.66 0c-1.14 0-2.08-1.05-2.08-2.33s.92-2.33 2.08-2.33 2.08 1.05 2.08 2.33-0.93 2.33-2.08 2.33Z" />
                                                        </svg>
                                                    </div>
                                                    <div>
                                                        <p class="text-sm font-bold text-white">Hubungkan Akun Discord
                                                        </p>
                                                        <p class="text-[10px] text-white/40 mt-1">Login lebih cepat
                                                            dengan Discord</p>
                                                    </div>
                                                </div>
                                                <button onclick="linkDiscord()"
                                                    class="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white text-[10px] font-black uppercase tracking-widest rounded-sm transition-all">
                                                    Link Discord
                                                </button>
                                            </div>
                                            <p class="text-[10px] text-white/30 mt-4">
                                                * Dengan menghubungkan Discord, kamu bisa login menggunakan akun
                                                Discord-mu tanpa perlu email dan password.
                                            </p>
                                            <% } %>
                                </div>

                                <!-- Quick Links -->
                                <div class="bg-white/5 border border-white/10 rounded-sm p-8 mt-8">
                                    <h3 class="text-lg font-black text-white uppercase tracking-tight italic mb-6">Quick
                                        Links</h3>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <a href="/history"
                                            class="p-4 bg-white/5 border border-white/10 hover:border-purple-500/50 rounded-sm text-center transition-all group">
                                            <svg class="w-6 h-6 mx-auto text-white/40 group-hover:text-purple-400 mb-2"
                                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                            <span
                                                class="text-[10px] font-black text-white/60 uppercase tracking-widest">History</span>
                                        </a>
                                        <a href="/favorites"
                                            class="p-4 bg-white/5 border border-white/10 hover:border-purple-500/50 rounded-sm text-center transition-all group">
                                            <svg class="w-6 h-6 mx-auto text-white/40 group-hover:text-purple-400 mb-2"
                                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                            </svg>
                                            <span
                                                class="text-[10px] font-black text-white/60 uppercase tracking-widest">Favorites</span>
                                        </a>
                                        <a href="/latest"
                                            class="p-4 bg-white/5 border border-white/10 hover:border-purple-500/50 rounded-sm text-center transition-all group">
                                            <svg class="w-6 h-6 mx-auto text-white/40 group-hover:text-purple-400 mb-2"
                                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M13 10V3L4 14h7v7l9-11h-7z" />
                                            </svg>
                                            <span
                                                class="text-[10px] font-black text-white/60 uppercase tracking-widest">Latest</span>
                                        </a>
                                        <a href="/popular"
                                            class="p-4 bg-white/5 border border-white/10 hover:border-purple-500/50 rounded-sm text-center transition-all group">
                                            <svg class="w-6 h-6 mx-auto text-white/40 group-hover:text-purple-400 mb-2"
                                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z" />
                                            </svg>
                                            <span
                                                class="text-[10px] font-black text-white/60 uppercase tracking-widest">Popular</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Back to Home -->
                        <div class="mt-16 text-center">
                            <a href="/"
                                class="inline-flex items-center gap-2 text-white/20 hover:text-white/60 text-xs font-bold uppercase tracking-widest transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 19l-7-7 7-7" />
                                </svg>
                                Kembali ke Home
                            </a>
                        </div>
    </div>
</div>

<script>
    // Current settings state
    let currentSettings = {
        show_favorites: false,
        show_reading_history: false
    };

    // Load settings on page load
    document.addEventListener('DOMContentLoaded', loadSettings);

    async function loadSettings() {
        try {
            const response = await fetch('/auth/settings');
            const data = await response.json();
            if (data.success && data.data?.settings) {
                currentSettings = data.data.settings;
                updateToggleUI();
            }
        } catch (error) {
            console.error('Failed to load settings:', error);
        }
    }

    function updateToggleUI() {
        // Update favorites toggle
        const favBtn = document.getElementById('toggle-favorites');
        const favDot = document.getElementById('toggle-favorites-dot');
        if (currentSettings.show_favorites) {
            favBtn.classList.remove('bg-white/10');
            favBtn.classList.add('bg-purple-600');
            favDot.classList.remove('left-1', 'bg-white/40');
            favDot.classList.add('left-7', 'bg-white');
        } else {
            favBtn.classList.add('bg-white/10');
            favBtn.classList.remove('bg-purple-600');
            favDot.classList.add('left-1', 'bg-white/40');
            favDot.classList.remove('left-7', 'bg-white');
        }

        // Update history toggle
        const histBtn = document.getElementById('toggle-history');
        const histDot = document.getElementById('toggle-history-dot');
        if (currentSettings.show_reading_history) {
            histBtn.classList.remove('bg-white/10');
            histBtn.classList.add('bg-purple-600');
            histDot.classList.remove('left-1', 'bg-white/40');
            histDot.classList.add('left-7', 'bg-white');
        } else {
            histBtn.classList.add('bg-white/10');
            histBtn.classList.remove('bg-purple-600');
            histDot.classList.add('left-1', 'bg-white/40');
            histDot.classList.remove('left-7', 'bg-white');
        }
    }

    async function toggleSetting(setting) {
        // Toggle the setting
        currentSettings[setting] = !currentSettings[setting];
        updateToggleUI();

        try {
            const response = await fetch('/auth/settings', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(currentSettings)
            });

            const data = await response.json();
            if (!data.success) {
                // Revert on failure
                currentSettings[setting] = !currentSettings[setting];
                updateToggleUI();
                alert('Gagal update settings');
            }
        } catch (error) {
            console.error('Failed to update settings:', error);
            // Revert on error
            currentSettings[setting] = !currentSettings[setting];
            updateToggleUI();
        }
    }

    // Discord Link function
    function linkDiscord() {
        window.location.href = '/auth/discord/link';
    }

    // Handle Discord link callback query params
    (function handleDiscordCallback() {
        const urlParams = new URLSearchParams(window.location.search);
        const success = urlParams.get('success');
        const error = urlParams.get('error');

        if (success === 'discord_linked') {
            alert('✅ Discord berhasil dihubungkan!');
            window.history.replaceState({}, document.title, window.location.pathname);
        } else if (error) {
            let errorMsg = 'Gagal menghubungkan Discord';
            if (error === 'discord_already_linked') {
                errorMsg = 'Discord ini sudah digunakan oleh akun lain';
            } else if (error === 'not_authenticated') {
                errorMsg = 'Kamu harus login terlebih dahulu';
            } else if (error === 'discord_link_failed') {
                errorMsg = 'Gagal menghubungkan Discord, coba lagi nanti';
            }
            alert('❌ ' + errorMsg);
            window.history.replaceState({}, document.title, window.location.pathname);
        }
    })();
</script>