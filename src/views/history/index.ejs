<div class="relative min-h-screen bg-primary-950">
  <!-- Mega Header Section -->
  <div class="relative pt-32 pb-16 overflow-hidden">
    <!-- Background Ambient Glow -->
    <div
      class="absolute top-0 right-0 -translate-y-1/2 translate-x-1/2 w-[800px] h-[800px] bg-purple-600/10 blur-[120px] rounded-full pointer-events-none">
    </div>
    <div
      class="absolute bottom-0 left-0 translate-y-1/2 -translate-x-1/2 w-[600px] h-[600px] bg-purple-900/10 blur-[100px] rounded-full pointer-events-none">
    </div>

    <div class="max-w-[1800px] mx-auto px-6 md:px-12 relative z-10">
      <div class="flex flex-col md:flex-row md:items-end justify-between gap-8">
        <div class="space-y-4">
          <div class="flex items-center gap-3 text-purple-500 font-black tracking-[0.3em] uppercase text-xs">
            <span class="w-12 h-[2px] bg-purple-500"></span>
            Your Activity
          </div>
          <h1 class="text-6xl md:text-8xl font-black text-white italic tracking-tighter uppercase leading-none">
            Reading<br><span class="text-transparent stroke-text">History</span>
          </h1>
          <p class="text-white/40 max-w-xl text-lg font-medium leading-relaxed">
            Lacak perjalanan membaca kamu. Lanjutin baca lagi komik favorit yang terakhir kamu buka di sini bos.
          </p>
        </div>

        <div class="flex items-center gap-4">
          <button id="clearAllHistory"
            class="group flex items-center gap-3 px-6 py-4 bg-white/5 hover:bg-red-600/20 border border-white/10 hover:border-red-500/50 rounded-sm transition-all duration-500">
            <svg class="w-5 h-5 text-white/60 group-hover:text-red-500 transition-colors" fill="none"
              stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
            <span
              class="text-xs font-black uppercase tracking-widest text-white/60 group-hover:text-white transition-colors">Hapus
              Semua</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Grid -->
  <main class="max-w-[1800px] mx-auto px-6 md:px-12 pb-32">
    <div id="history-container"
      class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6 md:gap-8">
      <!-- Items injected by JS -->
      <!-- Initial Shimmer State -->
      <% for(let i=0; i<12; i++) { %>
        <div class="space-y-4 animate-pulse">
          <div class="aspect-[2/3] bg-white/5 rounded-sm"></div>
          <div class="h-4 bg-white/5 w-3/4 rounded-sm"></div>
          <div class="h-3 bg-white/5 w-1/2 rounded-sm"></div>
        </div>
        <% } %>
    </div>
  </main>
</div>

<!-- Premium Delete Confirmation Modal -->
<div id="deleteModal"
  class="fixed inset-0 z-[200] flex items-center justify-center p-6 opacity-0 pointer-events-none transition-all duration-500">
  <div class="absolute inset-0 bg-black/90 backdrop-blur-xl"></div>
  <div
    class="relative w-full max-w-lg bg-primary-900 border border-white/10 p-10 rounded-sm transform scale-95 transition-transform duration-500">
    <div class="space-y-6 text-center">
      <div class="w-20 h-20 bg-red-600/20 rounded-full flex items-center justify-center mx-auto mb-8">
        <svg class="w-10 h-10 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
      </div>
      <h3 class="text-3xl font-black text-white italic uppercase tracking-tighter">Hapus Item?</h3>
      <p class="text-white/40 font-medium">Yakin bos mau hapus ini dari history? Gak bakal bisa balik lagi loh ya.</p>
      <div class="grid grid-cols-2 gap-4 mt-8">
        <button id="cancelDelete"
          class="py-4 bg-white/5 hover:bg-white/10 text-white text-xs font-black uppercase tracking-widest transition-all rounded-sm border border-white/10">Batal</button>
        <button id="confirmDelete"
          class="py-4 bg-red-600 hover:bg-red-700 text-white text-xs font-black uppercase tracking-widest transition-all rounded-sm shadow-[0_10px_30px_rgba(220,38,38,0.3)]">Hapus
          Dong</button>
      </div>
    </div>
  </div>
</div>

<!-- Premium Clear All Confirmation Modal -->
<div id="clearAllModal"
  class="fixed inset-0 z-[200] flex items-center justify-center p-6 opacity-0 pointer-events-none transition-all duration-500">
  <div class="absolute inset-0 bg-black/90 backdrop-blur-xl"></div>
  <div
    class="relative w-full max-w-lg bg-primary-900 border border-white/10 p-10 rounded-sm transform scale-95 transition-transform duration-500">
    <div class="space-y-6 text-center">
      <div class="w-20 h-20 bg-red-600/20 rounded-full flex items-center justify-center mx-auto mb-8">
        <svg class="w-10 h-10 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
      </div>
      <h3 class="text-3xl font-black text-white italic uppercase tracking-tighter">Kosongkan Semua?</h3>
      <p class="text-white/40 font-medium">Waduh serius nih bos mau hapus SEMUA history bacanya? Nanti lupa loh terakhir
        baca sampe mana.</p>
      <div class="grid grid-cols-2 gap-4 mt-8">
        <button id="cancelClearAll"
          class="py-4 bg-white/5 hover:bg-white/10 text-white text-xs font-black uppercase tracking-widest transition-all rounded-sm border border-white/10">Enggak
          Jadi</button>
        <button id="confirmClearAll"
          class="py-4 bg-red-600 hover:bg-red-700 text-white text-xs font-black uppercase tracking-widest transition-all rounded-sm shadow-[0_10px_30px_rgba(220,38,38,0.3)]">Sikat
          Habis!</button>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const historyContainer = document.getElementById('history-container');
    const deleteModal = document.getElementById('deleteModal');
    const clearAllModal = document.getElementById('clearAllModal');
    const cancelDelete = document.getElementById('cancelDelete');
    const confirmDelete = document.getElementById('confirmDelete');
    const cancelClearAll = document.getElementById('cancelClearAll');
    const confirmClearAll = document.getElementById('confirmClearAll');
    const clearAllBtn = document.getElementById('clearAllHistory');

    let currentDeleteIndex = -1;

    const wsrvUrl = (url) => {
      if (!url) return '/images/fallback.png';
      if (url.startsWith('http')) {
        return `https://wsrv.nl/?url=${encodeURIComponent(url)}&n=-1`;
      }
      return url;
    };

    function loadHistory() {
      try {
        const history = JSON.parse(localStorage.getItem('readingHistory') || '[]');
        return history.sort((a, b) => b.time - a.time);
      } catch (e) {
        return [];
      }
    }

    function formatDate(timestamp) {
      const date = new Date(timestamp);
      const now = new Date();
      const diffDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));

      if (diffDays === 0) return 'Hari Ini';
      if (diffDays === 1) return 'Kemarin';
      if (diffDays < 7) return `${diffDays} Hari Lalu`;
      return date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short' });
    }

    function showModal(modal) {
      modal.classList.remove('opacity-0', 'pointer-events-none');
      modal.querySelector('.relative').classList.remove('scale-95');
      modal.querySelector('.relative').classList.add('scale-100');
    }

    function hideModal(modal) {
      modal.classList.add('opacity-0', 'pointer-events-none');
      modal.querySelector('.relative').classList.add('scale-95');
      modal.querySelector('.relative').classList.remove('scale-100');
    }

    function updateDisplay() {
      const history = loadHistory();

      if (history.length === 0) {
        historyContainer.innerHTML = `
                    <div class="col-span-full py-32 text-center space-y-8 animate-fade-in">
                        <div class="w-32 h-32 bg-white/5 rounded-full flex items-center justify-center mx-auto border border-white/5">
                            <svg class="w-16 h-16 text-white/20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                            </svg>
                        </div>
                        <div class="space-y-4">
                            <h2 class="text-4xl font-black text-white italic uppercase tracking-tighter">Masih Kosong Melompong</h2>
                            <p class="text-white/40 font-medium">Belum ada history baca nih bos. Gas baca komik dulu!</p>
                        </div>
                        <a href="/popular" class="inline-flex items-center px-10 py-4 bg-purple-600 hover:bg-purple-700 text-white text-xs font-black uppercase tracking-[0.2em] rounded-sm transition-all shadow-[0_20px_40px_rgba(147,51,234,0.3)]">
                            Jelajahi Sekarang
                        </a>
                    </div>
                `;
        return;
      }

      historyContainer.innerHTML = history.map((item, index) => `
                <div class="group relative flex flex-col gap-4 animate-fade-in" style="animation-delay: ${index * 50}ms">
                    <div class="relative aspect-[2/3] overflow-hidden rounded-sm border border-white/5 shadow-2xl transition-all duration-700 group-hover:scale-105 group-hover:border-purple-500/50">
                        <img src="${wsrvUrl(item.image)}" alt="${item.title}" 
                            class="w-full h-full object-cover grayscale-[0.5] group-hover:grayscale-0 transition-all duration-700 scale-110 group-hover:scale-100"
                            onerror="this.src='/images/fallback.png'">
                        
                        <!-- Overlay Details -->
                        <div class="absolute inset-0 bg-gradient-to-t from-black via-black/20 to-transparent opacity-80 group-hover:opacity-60 transition-opacity"></div>
                        
                        <!-- Date Badge -->
                        <div class="absolute top-4 right-4 translate-x-4 opacity-0 group-hover:translate-x-0 group-hover:opacity-100 transition-all duration-500 delay-100">
                            <span class="px-3 py-1 bg-purple-600 text-[10px] font-black uppercase tracking-widest text-white rounded-px shadow-lg">
                                ${formatDate(item.time)}
                            </span>
                        </div>

                        <!-- Delete Single Item -->
                        <button class="delete-item absolute top-4 left-4 -translate-x-4 opacity-0 group-hover:translate-x-0 group-hover:opacity-100 transition-all duration-500 delay-150 p-2 bg-red-600/20 hover:bg-red-600 text-white rounded-sm border border-white/10" 
                            data-index="${index}">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>

                        <a href="${item.url}" class="absolute inset-0 z-10"></a>
                    </div>

                    <div class="space-y-1">
                        <h3 class="text-white font-black uppercase text-sm italic tracking-tight truncate group-hover:text-purple-400 transition-colors leading-tight">
                            ${item.title}
                        </h3>
                        <div class="flex items-center gap-2">
                            <span class="text-purple-500 text-[10px] font-black uppercase tracking-widest leading-none">Last Read</span>
                            <span class="text-white/40 text-[11px] font-bold truncate tracking-tight uppercase">${item.chapterTitle}</span>
                        </div>
                    </div>
                </div>
            `).join('');

      // Bind Delete Events
      document.querySelectorAll('.delete-item').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          currentDeleteIndex = btn.dataset.index;
          showModal(deleteModal);
        });
      });
    }

    // Action Handlers
    confirmDelete.addEventListener('click', () => {
      if (currentDeleteIndex !== -1) {
        const history = loadHistory();
        history.splice(currentDeleteIndex, 1);
        localStorage.setItem('readingHistory', JSON.stringify(history));
        updateDisplay();
        hideModal(deleteModal);
      }
    });

    clearAllBtn.addEventListener('click', () => showModal(clearAllModal));
    confirmClearAll.addEventListener('click', () => {
      localStorage.setItem('readingHistory', '[]');
      updateDisplay();
      hideModal(clearAllModal);
    });

    cancelDelete.addEventListener('click', () => hideModal(deleteModal));
    cancelClearAll.addEventListener('click', () => hideModal(clearAllModal));

    // Initial Load
    setTimeout(updateDisplay, 500);
  });
</script>

<style>
  .stroke-text {
    -webkit-text-stroke: 1px rgba(255, 255, 255, 0.2);
  }

  @keyframes fade-in {
    from {
      opacity: 0;
      transform: translateY(10px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    animation: fade-in 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }
</style>