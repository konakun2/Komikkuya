<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= title %>
    </title>

    <!-- SEO Meta Tags -->
    <meta name="description"
        content="<%= typeof metaDescription !== 'undefined' ? metaDescription : 'Baca komik gratis online di Komikkuya! Koleksi lengkap manga, manhwa, dan manhua terbaru tanpa iklan. Update setiap hari!' %>">
    <meta name="keywords"
        content="<%= typeof metaKeywords !== 'undefined' ? metaKeywords : 'komikkuya, komikkuya indonesia, komikkuya id, situs komikkuya, web komikkuya, baca komik komikkuya, komikkuya manga, komikkuya manhwa, komikkuya manhua, komikkuya baca gratis, baca komik gratis, manga online, manhwa indonesia, manhua terbaru, komik lengkap, baca manga gratis, baca manhwa gratis, baca manhua gratis, webtoon indonesia, novel grafis, komik bahasa indonesia, manga sub indo, manhwa sub indo, read manga online, read manhwa free, read manhua free, chapter terbaru, update chapter, chapter manga, chapter manhwa, komik chapter lengkap, baca chapter gratis, manga chapter update, manhwa full chapter, genre komik, genre manga, genre manhwa, komik romantis, komik romance, komik action, komik aksi, komik fantasi, komik fantasy, komik isekai, komik adventure, komik petualangan, komik horror, komik horor, komik comedy, komik komedi, komik slice of life, komik drama, komik school life, komik martial arts, komik wuxia, komik cultivation, komik reinkarnasi, komik reincarnation, komik harem, komik ecchi, komik seinen, komik shounen, komik shoujo, komik josei, manga populer, manhwa populer, manhua populer, komik populer, trending manga, trending manhwa, top manga, top manhwa, best manga, best manhwa, solo leveling, one piece, naruto, naruto shippuden, boruto, demon slayer, kimetsu no yaiba, jujutsu kaisen, attack on titan, shingeki no kyojin, blue lock, chainsaw man, spy x family, tokyo revengers, my hero academia, boku no hero, black clover, dragon ball, dragon ball super, bleach, bleach tybw, hunter x hunter, one punch man, mob psycho 100, death note, fullmetal alchemist, haikyuu, kuroko no basket, slam dunk, kaiju no 8, dandadan, sakamoto days, wind breaker, lookism, the beginning after the end, omniscient reader, tower of god, noblesse, eleceed, true beauty, lore olympus, I am the sorcerer king, the legendary mechanic, return of the mount hua sect, nano machine, volcanic age, komik online gratis, baca komik tanpa iklan, update komik terbaru, komik harian, manga terbaru 2025, manhwa terbaru 2025, manga terbaru 2026, manhwa terbaru 2026, komik terbaru 2025, komik terbaru 2026, komik update hari ini, baca komik online, situs baca manga, web komik gratis, website baca komik, aplikasi baca manga, baca manga bahasa indonesia, baca manhwa bahasa indonesia, komik translate indonesia, komik indo, manga indo, manhwa indo, manhua indo, alternatif komikku, alternatif mangaplus, alternatif otakudesu, alternatif komikcast, alternatif sektekomik, alternatif westmanga, alternatif mangaku, alternatif bacakomik, alternatif mangatoon, alternatif webtoon, alternatif komiku, alternatif kiryuu, alternatif komikid, alternatif mangacan, alternatif komikfox, alternatif komikmama, alternatif mangaid, alternatif mangafox, alternatif manhwaindo, alternatif tapas, alternatif tappytoon, alternatif lezhin, alternatif mangadex, alternatif kakaopage, alternatif crunchyroll, alternatif nekomik, alternatif maid, alternatif sektedoujin, alternatif doujindesu, alternatif komikindo, alternatif mangaindo, alternatif shinigami, alternatif mangasusu, alternatif komikav, alternatif ngomik, alternatif rawkuma, alternatif asurascans, alternatif reaperscans, alternatif flamecomics, alternatif luminousscans, mirip komikku, mirip mangaplus, mirip otakudesu, mirip komikcast, mirip webtoon, mirip mangaku, mirip kiryuu, mirip manhwaindo, mirip bacakomik, mirip mangadex, seperti komikku, seperti mangaplus, seperti otakudesu, seperti komikcast, seperti webtoon, seperti mangaku, pengganti komikku, pengganti mangaplus, pengganti otakudesu, pengganti komikcast, pengganti webtoon, pengganti mangaku, pengganti kiryuu, pengganti manhwaindo, situs seperti komikku, situs seperti mangaplus, situs mirip otakudesu, situs mirip komikcast, situs mirip webtoon, situs mirip manhwaindo' %>">
    <meta name="author" content="Komikkuya">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <link rel="canonical"
        href="<%= typeof canonicalUrl !== 'undefined' ? canonicalUrl : 'https://komikkuya.my.id' + (typeof currentPath !== 'undefined' ? currentPath : '') %>">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/assets/favicon.png">
    <link rel="apple-touch-icon" href="/assets/favicon.png">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="<%= typeof ogType !== 'undefined' ? ogType : 'website' %>">
    <meta property="og:url"
        content="<%= typeof canonicalUrl !== 'undefined' ? canonicalUrl : 'https://komikkuya.my.id' %>">
    <meta property="og:title" content="<%= title %>">
    <meta property="og:description"
        content="<%= typeof metaDescription !== 'undefined' ? metaDescription : 'Baca komik gratis online di Komikkuya! Koleksi lengkap manga, manhwa, dan manhua terbaru tanpa iklan.' %>">
    <meta property="og:image" content="<%= typeof ogImage !== 'undefined' ? ogImage : '/assets/og-image.png' %>">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Komikkuya">
    <meta property="og:locale" content="id_ID">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url"
        content="<%= typeof canonicalUrl !== 'undefined' ? canonicalUrl : 'https://komikkuya.my.id' %>">
    <meta name="twitter:title" content="<%= title %>">
    <meta name="twitter:description"
        content="<%= typeof metaDescription !== 'undefined' ? metaDescription : 'Baca komik gratis online di Komikkuya! Koleksi lengkap manga, manhwa, dan manhua terbaru tanpa iklan.' %>">
    <meta name="twitter:image" content="<%= typeof ogImage !== 'undefined' ? ogImage : '/assets/og-image.png' %>">

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    <%- typeof jsonLd !== 'undefined' ? JSON.stringify(jsonLd) : JSON.stringify({
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "Komikkuya",
        "alternateName": ["Komikkuya Indonesia", "Komikkuya ID", "Baca Komik Komikkuya", "Komikkuya Manga", "Komikkuya Manhwa", "Situs Komikkuya"],
        "url": "https://komikkuya.my.id",
        "description": "Komikkuya - Baca komik gratis online. Koleksi lengkap manga, manhwa, dan manhua terbaru tanpa iklan.",
        "inLanguage": "id-ID",
        "potentialAction": {
            "@type": "SearchAction",
            "target": {
                "@type": "EntryPoint",
                "urlTemplate": "https://komikkuya.my.id/api/search?query={search_term_string}"
            },
            "query-input": "required name=search_term_string"
        }
    }) %>
    </script>

    <!-- Organization Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "@id": "https://komikkuya.my.id/#organization",
        "name": "Komikkuya",
        "alternateName": ["Komikkuya Indonesia", "Komikkuya ID", "Komikkuya Manga", "Komikkuya Manhwa", "Komikkuya Manhua", "Situs Komikkuya", "Web Komikkuya"],
        "url": "https://komikkuya.my.id",
        "logo": {
            "@type": "ImageObject",
            "url": "https://komikkuya.my.id/assets/og-image.png",
            "width": 512,
            "height": 512
        },
        "image": "https://komikkuya.my.id/assets/og-image.png",
        "description": "Komikkuya adalah situs baca komik gratis online terlengkap. Manga, manhwa, dan manhua update setiap hari tanpa iklan! Komikkuya menyediakan ribuan judul komik dalam Bahasa Indonesia.",
        "foundingDate": "2025",
        "slogan": "Baca Komik Gratis di Komikkuya",
        "sameAs": [
            "https://github.com/ItzApipAjalah",
            "https://github.com/Komikkuya",
            "https://whatsapp.com/channel/0029Vb7586h2UPBFAPxb5S1P"
        ],
        "contactPoint": {
            "@type": "ContactPoint",
            "contactType": "customer support",
            "url": "https://komikkuya.my.id/contact",
            "email": "amwp@afifmedya.my.id",
            "availableLanguage": ["Indonesian", "English"]
        },
        "areaServed": {
            "@type": "Country",
            "name": "Indonesia"
        }
    }
    </script>

    <!-- Additional SEO -->
    <meta name="theme-color" content="#581845">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Komikkuya">

    <!-- Web App Manifest -->
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/assets/favicon.png">

    <!-- Breadcrumb Schema -->
    <% if (typeof breadcrumbs !=='undefined' && breadcrumbs.length> 0) { %>
        <script type="application/ld+json">
    <%- JSON.stringify({
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": breadcrumbs.map((item, index) => ({
            "@type": "ListItem",
            "position": index + 1,
            "name": item.name,
            "item": item.url
        }))
    }) %>
    </script>
        <% } %>

            <script src="https://cdn.tailwindcss.com"></script>
            <script>
                tailwind.config = {
                    darkMode: 'class',
                    theme: {
                        extend: {
                            colors: {
                                primary: {
                                    950: '#0f0c15',
                                    900: '#1a1625',
                                    800: '#2d2439',
                                    700: '#3f324d',
                                    600: '#514061',
                                }
                            },
                            animation: {
                                'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                                'float': 'float 6s ease-in-out infinite',
                            },
                            keyframes: {
                                float: {
                                    '0%, 100%': { transform: 'translateY(0)' },
                                    '50%': { transform: 'translateY(-10px)' },
                                }
                            }
                        }
                    }
                }
            </script>
            <style type="text/tailwindcss">
                @layer base {
            body {
                @apply bg-primary-900 text-white selection:bg-purple-600 selection:text-white;
                background-image: radial-gradient(circle at 50% 50%, rgba(88, 24, 69, 0.1) 0%, rgba(26, 22, 37, 1) 100%);
                font-family: 'Inter', sans-serif;
            }
        }
        
        .glass-effect {
            @apply bg-black/40 backdrop-blur-2xl border-b border-white/5;
        }
        
        .nav-link {
            @apply relative text-white/40 hover:text-white px-4 py-2 text-[10px] font-black uppercase tracking-[0.2em] transition-all duration-500 italic flex items-center;
        }
        
        .nav-link.active {
            @apply text-white;
        }
        
        .nav-link::after {
            content: '';
            @apply absolute bottom-0 left-4 right-4 h-0.5 bg-gradient-to-r from-purple-600 to-pink-600 scale-x-0 transition-transform duration-500;
        }
        
        .nav-link:hover::after, .nav-link.active::after {
            @apply scale-x-100;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 4px;
        }
        
        ::-webkit-scrollbar-track {
            background: #000;
        }
        
        ::-webkit-scrollbar-thumb {
            @apply bg-white/10 hover:bg-white/30 transition-colors;
        }
    </style>
</head>

<body class="min-h-screen">
    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 z-50 glass-effect">
        <div class="max-w-[1800px] mx-auto px-6">
            <div class="flex items-center justify-between h-20">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="/" class="flex items-center space-x-3 group">
                        <div
                            class="w-8 h-8 rounded-sm overflow-hidden transform group-hover:rotate-12 transition-transform duration-500 shadow-lg shadow-purple-500/20">
                            <img src="/assets/icon.png" alt="K" class="w-full h-full object-cover">
                        </div>
                        <span class="text-xl font-black text-white uppercase tracking-tighter italic">Komikkuya</span>
                    </a>
                </div>

                <!-- Navigation -->
                <nav class="hidden lg:flex items-center space-x-2">
                    <a href="/" class="nav-link">Home</a>
                    <a href="/popular" class="nav-link">Popular</a>
                    <a href="/genre" class="nav-link">Genres</a>
                    <a href="/latest" class="nav-link">Latest</a>
                    <a href="/doujin" class="nav-link" onclick="return checkAge(event, '/doujin')">Doujin</a>
                    <a href="/nhentai" class="nav-link" onclick="return checkAge(event, '/nhentai')">Nhentai</a>
                    <a href="/history" class="nav-link">History</a>
                    <a href="/favorites" class="nav-link">Favorites</a>
                </nav>

                <!-- Search & Mobile Menu -->
                <div class="flex items-center space-x-6">
                    <button id="search-button" class="text-white/40 hover:text-white transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </button>

                    <button id="mobile-menu-button" class="lg:hidden text-white/40 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                d="M4 8h16M4 16h16" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden lg:hidden bg-primary-900/95 backdrop-blur-3xl border-t border-white/5">
            <div class="px-6 py-8 space-y-4">
                <a href="/"
                    class="block text-2xl font-black text-white/40 hover:text-white uppercase italic tracking-tighter">Home</a>
                <a href="/popular"
                    class="block text-2xl font-black text-white/40 hover:text-white uppercase italic tracking-tighter">Popular</a>
                <a href="/genre"
                    class="block text-2xl font-black text-white/40 hover:text-white uppercase italic tracking-tighter">Genres</a>
                <a href="/latest"
                    class="block text-2xl font-black text-white/40 hover:text-white uppercase italic tracking-tighter">Latest</a>
                <a href="/doujin" onclick="return checkAge(event, '/doujin')"
                    class="block text-2xl font-black text-white/40 hover:text-white uppercase italic tracking-tighter">Doujin</a>
                <a href="/nhentai" onclick="return checkAge(event, '/nhentai')"
                    class="block text-2xl font-black text-white/40 hover:text-white uppercase italic tracking-tighter">Nhentai</a>
                <a href="/history"
                    class="block text-2xl font-black text-white/40 hover:text-white uppercase italic tracking-tighter">History</a>
                <a href="/favorites"
                    class="block text-2xl font-black text-white/40 hover:text-white uppercase italic tracking-tighter">Favorites</a>
            </div>
        </div>
    </header>

    <!-- Search Modal -->
    <div id="search-modal" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 bg-primary-950/95 backdrop-blur-3xl"></div>
        <div class="absolute inset-0 flex flex-col items-center justify-start pt-32 px-6">
            <div class="w-full max-w-5xl transform transition-all duration-700 translate-y-20 opacity-0"
                id="search-modal-content">
                <div class="flex items-center gap-6 mb-12">
                    <input type="text" id="search-input" placeholder="SEARCH FOR SERIES..."
                        class="w-full bg-transparent border-b-2 border-white/20 pb-4 text-4xl md:text-6xl font-black uppercase italic tracking-tighter placeholder:text-white/10 focus:outline-none focus:border-purple-600 transition-all">
                    <button id="close-search" class="text-white/20 hover:text-white p-2">
                        <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <div id="search-results" class="max-h-[60vh] overflow-y-auto no-scrollbar">
                    <div class="text-center py-20">
                        <p class="text-white/20 text-xs font-black uppercase tracking-[0.4em] italic leading-loose">
                            START TYPING TO DISCOVER NEW STORIES</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content (Full-Bleed Enabled) -->
    <main class="mt-20">
        <%- body %>
    </main>

    <!-- Cinematic Footer -->
    <footer class="bg-primary-950 border-t border-white/5 pt-20 pb-10">
        <div class="max-w-[1800px] mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-12 gap-12">
                <!-- Brand -->
                <div class="md:col-span-4">
                    <a href="/" class="flex items-center space-x-3 mb-6 group">
                        <div
                            class="w-8 h-8 rounded-sm overflow-hidden transform group-hover:rotate-12 transition-transform duration-500 shadow-lg shadow-purple-500/20">
                            <img src="/assets/icon.png" alt="K" class="w-full h-full object-cover">
                        </div>
                        <span class="text-xl font-black text-white uppercase tracking-tighter italic">Komikkuya</span>
                    </a>
                    <p class="text-white/40 text-xs font-bold uppercase tracking-[0.2em] leading-relaxed italic">
                        Premium Manga Streaming Experience.<br>
                        No Ads. No Distractions. Just Stories.
                    </p>
                </div>

                <!-- Links -->
                <div class="md:col-span-2">
                    <h3 class="text-[10px] font-black text-white uppercase tracking-[0.4em] mb-6 italic">Navigation</h3>
                    <div class="flex flex-col gap-3">
                        <a href="/popular"
                            class="text-white/30 hover:text-white text-[10px] font-black uppercase tracking-widest italic transition-all">Popular</a>
                        <a href="/latest"
                            class="text-white/30 hover:text-white text-[10px] font-black uppercase tracking-widest italic transition-all">Latest</a>
                        <a href="/genre"
                            class="text-white/30 hover:text-white text-[10px] font-black uppercase tracking-widest italic transition-all">Genres</a>
                    </div>
                </div>

                <div class="md:col-span-2">
                    <h3 class="text-[10px] font-black text-white uppercase tracking-[0.4em] mb-6 italic">Community</h3>
                    <div class="flex flex-col gap-3">
                        <a href="https://whatsapp.com/channel/0029Vb7586h2UPBFAPxb5S1P"
                            class="text-white/30 hover:text-white text-[10px] font-black uppercase tracking-widest italic transition-all">WhatsApp</a>
                        <a href="https://github.com/ItzApipAjalah"
                            class="text-white/30 hover:text-white text-[10px] font-black uppercase tracking-widest italic transition-all">GitHub</a>
                    </div>
                </div>

                <!-- Description -->
                <div class="md:col-span-4">
                    <p class="text-white/20 text-[9px] font-bold uppercase tracking-widest leading-loose text-justify">
                        Komikkuya provides high-quality manga, manhwa, and manhua content without the annoyance of
                        intrusive advertisements. Our platform is optimized for performance and visual excellence,
                        ensuring an immersive reading experience on any device.
                    </p>
                </div>
            </div>

            <div
                class="mt-20 pt-10 border-t border-white/5 flex flex-col md:flex-row justify-between items-center gap-6">
                <p class="text-white/10 text-[9px] font-black uppercase tracking-[0.3em]">© 2025 Komikkuya. High
                    Contrast Edition.</p>
                <div class="flex gap-8">
                    <a href="/privacy"
                        class="text-white/10 hover:text-white text-[8px] font-black uppercase tracking-widest italic transition-all">Privacy</a>
                    <a href="/terms"
                        class="text-white/10 hover:text-white text-[8px] font-black uppercase tracking-widest italic transition-all">Terms</a>
                    <a href="/dmca"
                        class="text-white/10 hover:text-white text-[8px] font-black uppercase tracking-widest italic transition-all">DMCA</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Mobile Menu Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');

            mobileMenuButton.addEventListener('click', function () {
                mobileMenu.classList.toggle('hidden');
            });

            // Set active navigation based on current URL
            const currentPath = window.location.pathname;
            const navLinks = document.querySelectorAll('.nav-link');

            navLinks.forEach(link => {
                if (link.getAttribute('href') === currentPath) {
                    link.classList.add('active');
                }
            });

            // Also set active state for mobile menu
            const mobileLinks = document.querySelectorAll('#mobile-menu a');
            mobileLinks.forEach(link => {
                if (link.getAttribute('href') === currentPath) {
                    link.classList.add('text-purple-400');
                }
            });
        });
    </script>

    <!-- Search Modal Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const searchButton = document.getElementById('search-button');
            const searchModal = document.getElementById('search-modal');
            const searchModalContent = document.getElementById('search-modal-content');
            const closeSearch = document.getElementById('close-search');
            const searchInput = document.getElementById('search-input');
            const searchResults = document.getElementById('search-results');
            let searchTimeout;

            // Open search modal
            searchButton.addEventListener('click', function () {
                searchModal.classList.remove('hidden');
                setTimeout(() => {
                    searchModalContent.classList.remove('translate-y-20', 'opacity-0');
                    searchModalContent.classList.add('translate-y-0', 'opacity-100');
                    searchInput.focus();
                }, 10);
            });

            // Close search modal
            closeSearch.addEventListener('click', function () {
                searchModalContent.classList.remove('translate-y-0', 'opacity-100');
                searchModalContent.classList.add('translate-y-20', 'opacity-0');
                setTimeout(() => {
                    searchModal.classList.add('hidden');
                }, 500);
            });

            // Close on escape key
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape' && !searchModal.classList.contains('hidden')) {
                    closeSearch.click();
                }
            });

            // Close on click outside
            searchModal.addEventListener('click', function (e) {
                if (e.target === searchModal) {
                    closeSearch.click();
                }
            });

            // Search functionality
            let isSearching = false;
            searchInput.addEventListener('input', function () {
                clearTimeout(searchTimeout);
                const query = this.value.trim();

                if (query.length < 2) {
                    isSearching = false;
                    searchResults.innerHTML = `
                        <div class="text-center text-gray-400 py-8">
                            <p>Type to search for manga</p>
                        </div>
                    `;
                    return;
                }

                // Show loading immediately
                isSearching = true;
                searchResults.innerHTML = `
                    <div class="text-center text-gray-400 py-12">
                        <div class="flex justify-center items-center space-x-2 mb-4">
                            <div class="w-3 h-3 bg-purple-500 rounded-full animate-bounce" style="animation-delay: 0ms;"></div>
                            <div class="w-3 h-3 bg-purple-500 rounded-full animate-bounce" style="animation-delay: 150ms;"></div>
                            <div class="w-3 h-3 bg-purple-500 rounded-full animate-bounce" style="animation-delay: 300ms;"></div>
                        </div>
                        <p class="text-sm">Searching across all sources...</p>
                        <p class="text-xs text-gray-500 mt-1">Komiku • Asia • International</p>
                    </div>
                `;

                searchTimeout = setTimeout(async () => {
                    try {
                        const response = await fetch(`/api/search?query=${encodeURIComponent(query)}`);
                        const data = await response.json();

                        // Only update if still searching (user didn't clear input)
                        if (!isSearching) return;

                        if (data.success && data.data && data.data.length > 0) {
                            searchResults.innerHTML = `
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    ${data.data.map(manga => {
                                // Handle different URL formats from Komiku, Asia, and International APIs
                                let mangaSlug = '';
                                if (manga.mangaUrl) {
                                    if (manga.mangaUrl.includes('/manga/')) {
                                        mangaSlug = manga.mangaUrl.split('/manga/')[1]?.replace('/', '') || '';
                                    } else if (manga.mangaUrl.includes('/comic/')) {
                                        mangaSlug = manga.mangaUrl.split('/comic/')[1]?.replace('/', '') || '';
                                    } else if (manga.mangaUrl.includes('/series/')) {
                                        // International API uses /series/ID/slug
                                        const urlParts = manga.mangaUrl.split('/').filter(p => p);
                                        mangaSlug = urlParts[urlParts.length - 1] || '';
                                    } else if (manga.slug) {
                                        mangaSlug = manga.slug;
                                    } else {
                                        const urlParts = manga.mangaUrl.split('/').filter(p => p);
                                        mangaSlug = urlParts[urlParts.length - 1] || '';
                                    }
                                } else if (manga.slug) {
                                    mangaSlug = manga.slug;
                                }

                                // Source label
                                let sourceLabel = manga.latestChapter ? manga.latestChapter.title : 'No chapters';
                                if (manga.source === 'asia') sourceLabel = 'Asia';
                                if (manga.source === 'international') sourceLabel = 'EN';

                                return `
                                        <a href="/manga/${mangaSlug}" class="group/search-item flex items-center gap-6 p-4 border-b border-white/5 hover:bg-white/5 transition-all">
                                            <div class="w-20 aspect-[2/3] overflow-hidden rounded-sm bg-primary-900 shadow-2xl">
                                                <img src="${manga.imageUrl}" alt="${manga.title}" class="w-full h-full object-cover group-hover/search-item:scale-110 transition-transform duration-700">
                                            </div>
                                            <div class="flex-1 min-w-0">
                                                <div class="flex items-center gap-3 mb-1">
                                                    <span class="text-purple-600 text-[8px] font-black uppercase tracking-widest italic">${manga.source || 'Server'}</span>
                                                    <span class="text-white/20 text-[8px] font-bold uppercase tracking-widest">${manga.type || 'Manga'}</span>
                                                </div>
                                                <h3 class="text-xl font-black text-white uppercase italic tracking-tighter truncate group-hover/search-item:text-purple-400 transition-colors">${manga.title}</h3>
                                                <p class="text-white/20 text-[10px] font-black uppercase tracking-widest italic truncate">${sourceLabel}</p>
                                            </div>
                                            <div class="opacity-0 group-hover/search-item:opacity-100 transition-opacity">
                                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M17 8l4 4m0 0l-4 4m4-4H3" /></svg>
                                            </div>
                                        </a>
                                    `}).join('')}
                                </div>
                            `;
                        } else {
                            searchResults.innerHTML = `
                                <div class="text-center text-gray-400 py-8">
                                    <p>No manga found for "${query}"</p>
                                </div>
                            `;
                        }
                    } catch (error) {
                        console.error('Error searching manga:', error);
                        searchResults.innerHTML = `
                            <div class="text-center text-red-400 py-8">
                                <p>Error searching manga. Please try again.</p>
                            </div>
                        `;
                    }
                }, 500);
            });
        });
    </script>

    <!-- Custom Right-Click Context Menu -->
    <div id="custom-context-menu" class="fixed z-[999] hidden">
        <div
            class="bg-primary-800/95 backdrop-blur-xl rounded-xl shadow-2xl border border-purple-500/30 py-2 min-w-[220px] overflow-hidden">
            <!-- Header -->
            <div class="px-4 py-3 border-b border-purple-500/20 flex items-center gap-3">
                <div
                    class="w-8 h-8 rounded-lg bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center">
                    <img src="/assets/icon.png" alt="K" class="w-full h-full rounded-lg object-contain">
                </div>
                <span class="font-bold text-white">Komikkuya</span>
            </div>

            <!-- Navigation -->
            <div class="py-1 border-b border-purple-500/10">
                <a href="/" class="context-menu-item">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                    <span>Home</span>
                    <span class="context-menu-shortcut">H</span>
                </a>
                <a href="/popular" class="context-menu-item">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                    </svg>
                    <span>Popular</span>
                    <span class="context-menu-shortcut">P</span>
                </a>
                <a href="/latest" class="context-menu-item">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span>Latest</span>
                    <span class="context-menu-shortcut">L</span>
                </a>
                <a href="/genre" class="context-menu-item">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A2 2 0 013 12V7a4 4 0 014-4z" />
                    </svg>
                    <span>Genre</span>
                    <span class="context-menu-shortcut">G</span>
                </a>
            </div>

            <!-- Utilities -->
            <div class="py-1 border-b border-purple-500/10">
                <button id="ctx-scroll-top" class="context-menu-item w-full text-left">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
                    </svg>
                    <span>Scroll to Top</span>
                    <span class="context-menu-shortcut">↑</span>
                </button>
                <button id="ctx-refresh" class="context-menu-item w-full text-left">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    <span>Refresh</span>
                    <span class="context-menu-shortcut">F5</span>
                </button>
                <button id="ctx-copy-link" class="context-menu-item w-full text-left">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                    </svg>
                    <span>Copy Link</span>
                    <span class="context-menu-shortcut">Ctrl+C</span>
                </button>
                <button id="ctx-share" class="context-menu-item w-full text-left">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                    </svg>
                    <span>Share</span>
                </button>
            </div>

            <!-- Social Links -->
            <div class="py-1 border-b border-purple-500/10">
                <a href="https://whatsapp.com/channel/0029Vb7586h2UPBFAPxb5S1P" target="_blank"
                    class="context-menu-item">
                    <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 24 24">
                        <path
                            d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" />
                    </svg>
                    <span>WhatsApp</span>
                </a>
                <a href="https://github.com/ItzApipAjalah" target="_blank" class="context-menu-item">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                        <path fill-rule="evenodd"
                            d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
                            clip-rule="evenodd" />
                    </svg>
                    <span>GitHub</span>
                </a>
            </div>

            <!-- About -->
            <div class="py-1">
                <a href="/about" class="context-menu-item">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span>About</span>
                </a>
            </div>
        </div>
    </div>

    <style>
        .context-menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 16px;
            color: #d1d5db;
            font-size: 14px;
            transition: all 0.15s ease;
            cursor: pointer;
            text-decoration: none;
            border: none;
            background: transparent;
        }

        .context-menu-item:hover {
            background: rgba(147, 51, 234, 0.2);
            color: white;
        }

        .context-menu-item svg {
            flex-shrink: 0;
        }

        .context-menu-item span:first-of-type {
            flex: 1;
        }

        .context-menu-shortcut {
            font-size: 11px;
            color: #6b7280;
            background: rgba(55, 48, 71, 0.5);
            padding: 2px 6px;
            border-radius: 4px;
        }
    </style>

    <script>
        // Custom Right-Click Context Menu
        document.addEventListener('DOMContentLoaded', function () {
            const contextMenu = document.getElementById('custom-context-menu');

            // Show custom context menu
            document.addEventListener('contextmenu', function (e) {
                e.preventDefault();

                // Position the menu
                const x = e.clientX;
                const y = e.clientY;

                // Get menu dimensions
                contextMenu.classList.remove('hidden');
                const menuWidth = contextMenu.offsetWidth;
                const menuHeight = contextMenu.offsetHeight;

                // Adjust position if menu goes off screen
                let posX = x;
                let posY = y;

                if (x + menuWidth > window.innerWidth) {
                    posX = window.innerWidth - menuWidth - 10;
                }
                if (y + menuHeight > window.innerHeight) {
                    posY = window.innerHeight - menuHeight - 10;
                }

                contextMenu.style.left = posX + 'px';
                contextMenu.style.top = posY + 'px';
            });

            // Hide context menu on click anywhere
            document.addEventListener('click', function () {
                contextMenu.classList.add('hidden');
            });

            // Hide on scroll
            document.addEventListener('scroll', function () {
                contextMenu.classList.add('hidden');
            });

            // Hide on escape key
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') {
                    contextMenu.classList.add('hidden');
                }
            });

            // Scroll to top
            document.getElementById('ctx-scroll-top').addEventListener('click', function () {
                window.scrollTo({ top: 0, behavior: 'smooth' });
                contextMenu.classList.add('hidden');
            });

            // Refresh page
            document.getElementById('ctx-refresh').addEventListener('click', function () {
                location.reload();
            });

            // Copy link
            document.getElementById('ctx-copy-link').addEventListener('click', async function () {
                try {
                    await navigator.clipboard.writeText(window.location.href);
                    // Show a toast notification
                    showToast('Link copied to clipboard!');
                } catch (err) {
                    console.error('Failed to copy: ', err);
                }
                contextMenu.classList.add('hidden');
            });

            // Share
            document.getElementById('ctx-share').addEventListener('click', async function () {
                if (navigator.share) {
                    try {
                        await navigator.share({
                            title: document.title,
                            url: window.location.href
                        });
                    } catch (err) {
                        console.log('Share cancelled');
                    }
                } else {
                    // Fallback to copy link
                    await navigator.clipboard.writeText(window.location.href);
                    showToast('Link copied to clipboard!');
                }
                contextMenu.classList.add('hidden');
            });

            // Toast notification
            function showToast(message) {
                const toast = document.createElement('div');
                toast.className = 'fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-purple-600 text-white px-4 py-2 rounded-lg shadow-lg z-[9999] animate-pulse';
                toast.textContent = message;
                document.body.appendChild(toast);

                setTimeout(() => {
                    toast.remove();
                }, 2000);
            }

            // Keyboard shortcuts
            document.addEventListener('keydown', function (e) {
                // Only trigger if no input is focused
                if (document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA') {
                    return;
                }

                if (e.key === 'h' || e.key === 'H') {
                    window.location.href = '/';
                } else if (e.key === 'p' || e.key === 'P') {
                    window.location.href = '/popular';
                } else if (e.key === 'l' || e.key === 'L') {
                    window.location.href = '/latest';
                } else if (e.key === 'g' || e.key === 'G') {
                    window.location.href = '/genre';
                }
            });
        });
    </script>

    <!-- Vercel Speed Insights -->
    <script>
        window.si = window.si || function () { (window.siq = window.siq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/speed-insights/script.js"></script>

    <!-- Age Verification Modal -->
    <div id="ageVerifyModal" class="fixed inset-0 z-[9999] hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeAgeModal()"></div>
        <div class="absolute inset-0 flex items-center justify-center p-4 pointer-events-none">
            <div
                class="bg-primary-800/95 backdrop-blur-md rounded-2xl p-8 max-w-md w-full shadow-2xl border border-purple-500/30 pointer-events-auto">
                <div class="text-center">
                    <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-red-500/20 flex items-center justify-center">
                        <svg class="w-10 h-10 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                    </div>

                    <h2 class="text-2xl font-bold text-white mb-4">⚠️ Peringatan Konten Dewasa</h2>
                    <p class="text-gray-300 mb-6 leading-relaxed">
                        Konten ini mengandung materi <span class="text-red-400 font-semibold">18+</span> yang tidak
                        sesuai untuk anak di bawah umur.
                    </p>
                    <p class="text-gray-400 text-sm mb-8">
                        Apakah kamu sudah berusia <span class="text-purple-400 font-bold">18 tahun atau lebih</span>?
                    </p>

                    <div class="flex flex-col sm:flex-row gap-3">
                        <button onclick="closeAgeModal()"
                            class="flex-1 px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-xl transition-all font-medium">
                            ❌ Belum 18+
                        </button>
                        <button onclick="confirmAge()"
                            class="flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white rounded-xl transition-all font-medium">
                            ✅ Sudah 18+
                        </button>
                    </div>

                    <p class="text-gray-500 text-xs mt-6">
                        Dengan melanjutkan, kamu menyetujui bahwa kamu sudah cukup umur untuk melihat konten dewasa.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let pendingAdultUrl = null;

        function checkAge(event, url) {
            event.preventDefault();

            if (localStorage.getItem('ageVerified') === 'true') {
                window.location.href = url;
                return false;
            }

            pendingAdultUrl = url;
            document.getElementById('ageVerifyModal').classList.remove('hidden');
            return false;
        }

        function confirmAge() {
            localStorage.setItem('ageVerified', 'true');
            document.getElementById('ageVerifyModal').classList.add('hidden');
            if (pendingAdultUrl) {
                window.location.href = pendingAdultUrl;
            }
        }

        function closeAgeModal() {
            document.getElementById('ageVerifyModal').classList.add('hidden');
            pendingAdultUrl = null;
        }
    </script>

    <!-- Global Image Fallback Handler -->
    <script>
        const FALLBACK_IMAGE = '/images/fallback.png';

        // Handle all image errors globally
        document.addEventListener('error', function (e) {
            if (e.target.tagName === 'IMG' && !e.target.dataset.fallbackApplied) {
                e.target.dataset.fallbackApplied = 'true';
                e.target.src = FALLBACK_IMAGE;
            }
        }, true);

        // Also handle images that are already in DOM
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('img').forEach(function (img) {
                if (!img.complete || img.naturalHeight === 0) {
                    img.onerror = function () {
                        if (!this.dataset.fallbackApplied) {
                            this.dataset.fallbackApplied = 'true';
                            this.src = FALLBACK_IMAGE;
                        }
                    };
                }
            });
        });
    </script>
</body>

</html>