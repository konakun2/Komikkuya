<div class="relative min-h-screen bg-primary-950 overflow-hidden">
    <!-- Background Ambient Glows -->
    <div
        class="absolute top-0 right-0 -translate-y-1/2 translate-x-1/2 w-[800px] h-[800px] bg-purple-600/10 blur-[120px] rounded-full pointer-events-none">
    </div>
    <div
        class="absolute bottom-0 left-0 translate-y-1/2 -translate-x-1/2 w-[600px] h-[600px] bg-purple-900/10 blur-[100px] rounded-full pointer-events-none">
    </div>

    <div class="max-w-4xl mx-auto px-6 py-32 relative z-10">
        <!-- Header -->
        <div class="text-center mb-16">
            <div
                class="flex items-center justify-center gap-3 text-purple-500 font-black tracking-[0.3em] uppercase text-xs mb-4">
                <span class="w-12 h-[2px] bg-purple-500"></span>
                AKUN KAMU
                <span class="w-12 h-[2px] bg-purple-500"></span>
            </div>
            <h1 class="text-5xl md:text-6xl font-black text-white italic tracking-tighter uppercase">
                Dashboard
            </h1>
        </div>

        <!-- Messages -->
        <% if (typeof error !=='undefined' && error) { %>
            <div class="mb-6 p-4 bg-red-500/20 border border-red-500/30 rounded-sm">
                <p class="text-red-400 text-sm font-bold text-center">
                    <%= error %>
                </p>
            </div>
            <% } %>
                <% if (typeof success !=='undefined' && success) { %>
                    <div class="mb-6 p-4 bg-green-500/20 border border-green-500/30 rounded-sm">
                        <p class="text-green-400 text-sm font-bold text-center">
                            <%= success %>
                        </p>
                    </div>
                    <% } %>

                        <div class="grid md:grid-cols-3 gap-8">
                            <!-- Profile Card -->
                            <div class="md:col-span-1">
                                <div class="bg-white/5 border border-white/10 rounded-sm p-8 text-center">
                                    <!-- Profile Picture -->
                                    <div class="relative inline-block mb-6">
                                        <div
                                            class="w-32 h-32 rounded-full overflow-hidden border-4 border-purple-500/50 mx-auto bg-white/10">
                                            <% if (user.profile_picture_url) { %>
                                                <img src="<%= user.profile_picture_url %>" alt="Profile"
                                                    class="w-full h-full object-cover">
                                                <% } else { %>
                                                    <div
                                                        class="w-full h-full flex items-center justify-center text-4xl font-black text-white/40 uppercase">
                                                        <%= user.username.charAt(0) %>
                                                    </div>
                                                    <% } %>
                                        </div>
                                    </div>

                                    <h2 class="text-xl font-black text-white uppercase tracking-tight italic">
                                        <%= user.username %>
                                    </h2>
                                    <p class="text-white/40 text-sm mt-1">
                                        <%= user.email %>
                                    </p>

                                    <!-- Profile Picture Upload -->
                                    <form action="/auth/profile-picture" method="POST" enctype="multipart/form-data"
                                        class="mt-6">
                                        <label for="profile-pic"
                                            class="block w-full py-3 px-4 bg-white/5 border border-white/10 rounded-sm text-[10px] font-black text-white/60 uppercase tracking-widest cursor-pointer hover:bg-white/10 transition-colors">
                                            <span id="file-label">Pilih Foto</span>
                                            <input type="file" id="profile-pic" name="file" accept="image/*"
                                                class="hidden"
                                                onchange="document.getElementById('file-label').textContent = this.files[0]?.name || 'Pilih Foto'">
                                        </label>
                                        <button type="submit"
                                            class="w-full mt-2 py-2 bg-purple-600/30 hover:bg-purple-600 text-white text-[10px] font-black uppercase tracking-widest rounded-sm transition-all">
                                            Upload Foto
                                        </button>
                                    </form>

                                    <% if (user.profile_picture) { %>
                                        <form action="/auth/delete-profile-picture" method="POST" class="mt-2">
                                            <button type="submit"
                                                class="w-full py-2 bg-red-600/20 hover:bg-red-600 text-red-400 hover:text-white text-[10px] font-black uppercase tracking-widest rounded-sm transition-all">
                                                Hapus Foto
                                            </button>
                                        </form>
                                        <% } %>

                                            <!-- Logout Button -->
                                            <a href="/auth/logout"
                                                class="block w-full mt-8 py-3 border border-white/10 hover:border-red-500/50 text-white/40 hover:text-red-400 text-[10px] font-black uppercase tracking-widest rounded-sm transition-all text-center">
                                                Logout
                                            </a>
                                </div>
                            </div>

                            <!-- Edit Profile -->
                            <div class="md:col-span-2">
                                <div class="bg-white/5 border border-white/10 rounded-sm p-8">
                                    <h3 class="text-lg font-black text-white uppercase tracking-tight italic mb-8">Edit
                                        Profil</h3>

                                    <form action="/auth/profile" method="POST" class="space-y-6">
                                        <div class="space-y-2">
                                            <label for="edit-username"
                                                class="block text-[10px] font-black text-white/40 uppercase tracking-[0.2em]">Username</label>
                                            <input type="text" id="edit-username" name="username"
                                                value="<%= user.username %>" required
                                                class="w-full bg-white/5 border border-white/10 rounded-sm px-4 py-4 text-white font-bold placeholder:text-white/20 focus:outline-none focus:border-purple-500 transition-colors">
                                        </div>

                                        <div class="space-y-2">
                                            <label for="edit-email"
                                                class="block text-[10px] font-black text-white/40 uppercase tracking-[0.2em]">Email</label>
                                            <input type="email" id="edit-email" name="email" value="<%= user.email %>"
                                                required
                                                class="w-full bg-white/5 border border-white/10 rounded-sm px-4 py-4 text-white font-bold placeholder:text-white/20 focus:outline-none focus:border-purple-500 transition-colors">
                                        </div>

                                        <button type="submit"
                                            class="w-full py-4 bg-purple-600 hover:bg-purple-700 text-white font-black uppercase text-sm tracking-widest rounded-sm transition-all shadow-[0_10px_40px_rgba(147,51,234,0.3)] hover:-translate-y-0.5">
                                            Simpan Perubahan
                                        </button>
                                    </form>
                                </div>

                                <!-- Privacy Settings -->
                                <div class="bg-white/5 border border-white/10 rounded-sm p-8 mt-8">
                                    <h3 class="text-lg font-black text-white uppercase tracking-tight italic mb-6">
                                        Privacy Settings</h3>

                                    <div class="space-y-4">
                                        <!-- Show Favorites Toggle -->
                                        <div
                                            class="flex items-center justify-between p-4 bg-white/5 border border-white/10 rounded-sm">
                                            <div>
                                                <p class="text-sm font-bold text-white">Tampilkan Favorites</p>
                                                <p class="text-[10px] text-white/40 mt-1">Izinkan orang lain melihat
                                                    daftar favorites kamu</p>
                                            </div>
                                            <button id="toggle-favorites" onclick="toggleSetting('show_favorites')"
                                                class="relative w-12 h-6 bg-white/10 rounded-full transition-colors duration-300">
                                                <span id="toggle-favorites-dot"
                                                    class="absolute left-1 top-1 w-4 h-4 bg-white/40 rounded-full transition-all duration-300"></span>
                                            </button>
                                        </div>

                                        <!-- Show Reading History Toggle -->
                                        <div
                                            class="flex items-center justify-between p-4 bg-white/5 border border-white/10 rounded-sm">
                                            <div>
                                                <p class="text-sm font-bold text-white">Tampilkan Riwayat Baca</p>
                                                <p class="text-[10px] text-white/40 mt-1">Izinkan orang lain melihat
                                                    riwayat bacaan kamu</p>
                                            </div>
                                            <button id="toggle-history" onclick="toggleSetting('show_reading_history')"
                                                class="relative w-12 h-6 bg-white/10 rounded-full transition-colors duration-300">
                                                <span id="toggle-history-dot"
                                                    class="absolute left-1 top-1 w-4 h-4 bg-white/40 rounded-full transition-all duration-300"></span>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Quick Links -->
                                <div class="bg-white/5 border border-white/10 rounded-sm p-8 mt-8">
                                    <h3 class="text-lg font-black text-white uppercase tracking-tight italic mb-6">Quick
                                        Links</h3>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <a href="/history"
                                            class="p-4 bg-white/5 border border-white/10 hover:border-purple-500/50 rounded-sm text-center transition-all group">
                                            <svg class="w-6 h-6 mx-auto text-white/40 group-hover:text-purple-400 mb-2"
                                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                            <span
                                                class="text-[10px] font-black text-white/60 uppercase tracking-widest">History</span>
                                        </a>
                                        <a href="/favorites"
                                            class="p-4 bg-white/5 border border-white/10 hover:border-purple-500/50 rounded-sm text-center transition-all group">
                                            <svg class="w-6 h-6 mx-auto text-white/40 group-hover:text-purple-400 mb-2"
                                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                            </svg>
                                            <span
                                                class="text-[10px] font-black text-white/60 uppercase tracking-widest">Favorites</span>
                                        </a>
                                        <a href="/latest"
                                            class="p-4 bg-white/5 border border-white/10 hover:border-purple-500/50 rounded-sm text-center transition-all group">
                                            <svg class="w-6 h-6 mx-auto text-white/40 group-hover:text-purple-400 mb-2"
                                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M13 10V3L4 14h7v7l9-11h-7z" />
                                            </svg>
                                            <span
                                                class="text-[10px] font-black text-white/60 uppercase tracking-widest">Latest</span>
                                        </a>
                                        <a href="/popular"
                                            class="p-4 bg-white/5 border border-white/10 hover:border-purple-500/50 rounded-sm text-center transition-all group">
                                            <svg class="w-6 h-6 mx-auto text-white/40 group-hover:text-purple-400 mb-2"
                                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z" />
                                            </svg>
                                            <span
                                                class="text-[10px] font-black text-white/60 uppercase tracking-widest">Popular</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Back to Home -->
                        <div class="mt-16 text-center">
                            <a href="/"
                                class="inline-flex items-center gap-2 text-white/20 hover:text-white/60 text-xs font-bold uppercase tracking-widest transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 19l-7-7 7-7" />
                                </svg>
                                Kembali ke Home
                            </a>
                        </div>
    </div>
</div>

<script>
    // Current settings state
    let currentSettings = {
        show_favorites: false,
        show_reading_history: false
    };

    // Load settings on page load
    document.addEventListener('DOMContentLoaded', loadSettings);

    async function loadSettings() {
        try {
            const response = await fetch('/auth/settings');
            const data = await response.json();
            if (data.success && data.data?.settings) {
                currentSettings = data.data.settings;
                updateToggleUI();
            }
        } catch (error) {
            console.error('Failed to load settings:', error);
        }
    }

    function updateToggleUI() {
        // Update favorites toggle
        const favBtn = document.getElementById('toggle-favorites');
        const favDot = document.getElementById('toggle-favorites-dot');
        if (currentSettings.show_favorites) {
            favBtn.classList.remove('bg-white/10');
            favBtn.classList.add('bg-purple-600');
            favDot.classList.remove('left-1', 'bg-white/40');
            favDot.classList.add('left-7', 'bg-white');
        } else {
            favBtn.classList.add('bg-white/10');
            favBtn.classList.remove('bg-purple-600');
            favDot.classList.add('left-1', 'bg-white/40');
            favDot.classList.remove('left-7', 'bg-white');
        }

        // Update history toggle
        const histBtn = document.getElementById('toggle-history');
        const histDot = document.getElementById('toggle-history-dot');
        if (currentSettings.show_reading_history) {
            histBtn.classList.remove('bg-white/10');
            histBtn.classList.add('bg-purple-600');
            histDot.classList.remove('left-1', 'bg-white/40');
            histDot.classList.add('left-7', 'bg-white');
        } else {
            histBtn.classList.add('bg-white/10');
            histBtn.classList.remove('bg-purple-600');
            histDot.classList.add('left-1', 'bg-white/40');
            histDot.classList.remove('left-7', 'bg-white');
        }
    }

    async function toggleSetting(setting) {
        // Toggle the setting
        currentSettings[setting] = !currentSettings[setting];
        updateToggleUI();

        try {
            const response = await fetch('/auth/settings', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(currentSettings)
            });

            const data = await response.json();
            if (!data.success) {
                // Revert on failure
                currentSettings[setting] = !currentSettings[setting];
                updateToggleUI();
                alert('Gagal update settings');
            }
        } catch (error) {
            console.error('Failed to update settings:', error);
            // Revert on error
            currentSettings[setting] = !currentSettings[setting];
            updateToggleUI();
        }
    }
</script>